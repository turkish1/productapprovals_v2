import{u as y}from"./accountsStore-Ck5sWur0.js";import{e as i,f as d,h as _,y as j}from"./index-PV4IfQic.js";import{u as x}from"./useAxios-60L-vhiw.js";function G(){const n=i(null),u=i(null);let c=null;const e=i([]);let r=d({});const t=d({dba:"",email:"",cphone:"",bphone:"",expiration_date:"",name:"",projects:[],secondary_status:"",license:"",phone:""}),p=i(null),{addUser:h}=y();_(()=>{c=google.accounts.oauth2.initTokenClient({client_id:"978320609817-r83rgg9qsb4ntam9dek995cqcn779qut.apps.googleusercontent.com",scope:["openid","email","profile","https://www.googleapis.com/auth/gmail.readonly"].join(" "),callback:f})});const v=()=>c.requestAccessToken({prompt:"consent"},g()),w=()=>{n.value&&google.accounts.oauth2.revoke(n.value,()=>{n.value=null,u.value=null})};async function g(){let o="https://us-east-1.aws.data.mongodb-api.com/app/data-aquwo/endpoint/getaccounts";const{execute:s,then:l,data:a}=x(o,{method:"GET"},{immediate:!1});let b=i([]);b.value=s().then(q=>{r=a.value;for(const[T,k]of Object.entries(r))e.value.push(k)})}async function f(o){if(o.error)return console.error(o);n.value=o.access_token,j("sessionTokenId",n.value,sessionStorage);const s=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${o.access_token}`}}).then(l=>l.json());p.value=s.email,await m(p)}async function m(o){var l;const s=await o.value;console.log(s);for(let a=0;a<=e.value[0].length;a++)await((l=e.value[0][a])==null?void 0:l.email)===s&&(t.email=await e.value[0][a].email,t.name=await e.value[0][a].name,t.dba=await e.value[0][a].dba,t.cphone=await e.value[0][a].cphone,t.bphone=await e.value[0][a].bphone,t.phone=await e.value[0][a].bphone,t.expiration_date=await e.value[0][a].expiration_date,t.projects=await e.value[0][a].projects,t.secondary_status=await e.value[0][0].secondary_status,t.license=await e.value[0][a].license,await h(t))}return{accessToken:n,idPayload:u,signIn:v,signOut:w,checkEmail:m,localData:e,acctUser:t}}export{G as u};
