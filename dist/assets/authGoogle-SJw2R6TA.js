import{s as A}from"./index-CkuIhVEU.js";import{u as C}from"./accountsStore-4zZYQV7T.js";import{u as q}from"./useAxios-OAQaXJYc.js";import{e as n,j as w,f as G,u as N,w as T,k as E,o as k,c as b,g as r,h as D,l as x,p as u,a as U,d as y,t as V,q as j,v as z,x as O}from"./index-Bv5J4zq0.js";import{u as R}from"./auth-BhJt33Vu.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DbBDEmZW.js";function $(){const s=n(null),c=n(null);let i=null;const o=n([]);let p=w({});const a=w({dba:"",email:"",cphone:"",bphone:"",expiration_date:"",name:"",projects:[],secondary_status:"",license:"",projects:[],phone:""}),m=n(null),{addUser:v}=C();G(()=>{i=google.accounts.oauth2.initTokenClient({client_id:"978320609817-r83rgg9qsb4ntam9dek995cqcn779qut.apps.googleusercontent.com",scope:["openid","email","profile","https://www.googleapis.com/auth/gmail.readonly"].join(" "),callback:_})});const g=()=>i.requestAccessToken({prompt:"consent"},d()),f=()=>{s.value&&google.accounts.oauth2.revoke(s.value,()=>{s.value=null,c.value=null})};async function d(){let t="https://us-east-1.aws.data.mongodb-api.com/app/data-aquwo/endpoint/getaccounts";const{execute:l,then:e,data:B}=q(t,{method:"GET"},{immediate:!1});let I=n([]);I.value=l().then(X=>{p=B.value;for(const[Y,S]of Object.entries(p))o.value.push(S);console.log(o.value)})}async function _(t){if(t.error)return console.error(t);s.value=t.access_token;const l=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}).then(e=>e.json());m.value=l.email,h(m)}async function h(t){const l=await t.value;console.log(l,t.value);for(let e=0;e<=o.value[0].length;e++)console.log(o.value[0][e].email,t.value),o.value[0][e].email===l&&(a.email=await o.value[0][e].email,a.name=await o.value[0][e].name,a.dba=o.value[0][e].dba,a.cphone=o.value[0][e].cphone,a.bphone=o.value[0][e].bphone,a.phone=o.value[0][e].bphone,a.expiration_date=o.value[0][e].expiration_date,a.projects=o.value[0][e].projects,a.secondary_status=o.value[0][e].secondary_status,a.email=o.value[0][e].email,a.license=o.value[0][e].license,console.log(a),v(a))}return{accessToken:s,idPayload:c,signIn:g,signOut:f,checkEmail:h,localData:o,acctUser:a}}const M=s=>(z("data-v-36074342"),s=s(),O(),s),F={class:"relative w-full h-screen overflow-hidden"},H={class:"relative z-10 flex items-center justify-center h-full bg-black/50"},J={style:{"border-radius":"20px",padding:"0.5rem"}},K={class:"container w-full py-15 px-8 sm:px-2"},L=M(()=>r("button",{id:"googleBtn"},null,-1)),Q={key:0},W={__name:"authGoogle",setup(s){const{accessToken:c,idPayload:i,signIn:o,signOut:p,localData:a,acctUser:m}=$();n(!1);const v=N();n(!1);const g=n([]);R(),n([]),w({dba:"",email:"",cphone:"",bphone:"",expiration_date:"",name:"",projects:[],secondary_status:"",license:""});const{getUser:f}=C(),d=()=>{console.log(f),a.value.forEach((t,l)=>{for(let e=0;e<t.length;e++)c.value&&(g.value.push(t[e]),_())})};function _(){h()}function h(){v.push("/permitapp")}return T(d,()=>{}),E(()=>{c.value&&fetch("https://gmail.googleapis.com/gmail/v1/users/me/messages?maxResults=4",{headers:{Authorization:`Bearer ${c.value}`}}).then(t=>t.json()).then(console.log)}),(t,l)=>{const e=A;return k(),b("div",F,[r("div",H,[r("div",J,[r("div",K,[r("div",null,[D(e,{onClick:u(o),onChange:d,severity:"constrast",raised:"",onInput:t.email},{default:x(()=>[j("Sign in with Google")]),_:1},8,["onClick","onInput"]),u(c)?(k(),U(e,{key:0,onClick:u(p)},{default:x(()=>[j("SignÂ out")]),_:1},8,["onClick"])):y("",!0),L])]),u(i)?(k(),b("pre",Q,V(u(i)),1)):y("",!0)])])])}}},le=P(W,[["__scopeId","data-v-36074342"]]);export{le as default};
