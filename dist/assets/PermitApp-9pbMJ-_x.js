import{s as le}from"./index-BrUI7XFy.js";import{s as se}from"./index-CZco6-ny.js";import{s as te}from"./index-s0wVdkMK.js";import{s as ne}from"./index-DxI8E_pd.js";import{u as ie,a as ue,_ as re}from"./use-createProcessnumber-CEMwtpps.js";import{e as a,u as de,h as $,f as ce,Y as me,I as q,ac as pe,ad as ve,o as S,c as M,a as fe,d as B,i as o,j as n,J as he,t as _e,F as be,ae as ye,X as z,p as ge,q as Ve}from"./index-25ndKMvN.js";import{u as Pe,a as Se}from"./useAxios-CfJThO0u.js";import{u as ke}from"./useScreenSize-CiIdHq_Z.js";import{u as we}from"./processStore-ebTbzKlq.js";import{u as Ie}from"./accountsStore-DKSqIzje.js";import{u as Ue}from"./permitapp-dPLoVfQR.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DMXCqxfX.js";import"./index-BIzJKC8B.js";import"./index-Bpha4DLT.js";import"./index-BtLDZFp2.js";import"./index-DHWlndRg.js";import"./index-BpmKU0G7.js";import"./index-BOflOHxW.js";import"./index-BPwh7jnh.js";const Me="https://mg7y3qizyjvkkwd7ynpoc2r2yi0gerzh.lambda-url.us-east-1.on.aws/";function Be(){const r=a(!1),p=a(null),v=a(null),{data:k,error:f,isFetching:A,execute:d}=Pe(Me,{method:"POST",headers:{"Content-Type":"application/json"}},Se,{immediate:!1});return{data:k,errors:p,isFetching:A,loading:r,callPermitdata:async x=>{v.value=x,console.log(v.value),r.value=!0,f.value=null;try{return await d({data:v.value})}catch(_){f.value=_.massage,console.error("Lambda post failed:",_)}finally{r.value=!1}}}}const u=r=>(ge("data-v-0a6e14d0"),r=r(),Ve(),r),Ae={class:"hero"},xe={class:"card"},De=u(()=>o("h1",{class:"title"},"Permit Application",-1)),Ce={class:"field"},je=u(()=>o("label",{for:"license"},"License Status",-1)),Ee={class:"field"},Fe=u(()=>o("label",{for:"processMuni"},"Municipality Process #",-1)),Le={class:"field"},Oe=u(()=>o("label",{for:"addr"},"Property Address",-1)),Re={class:"input-row"},Te={class:"field"},We={key:0,class:"historic-indicator"},$e={class:"field"},qe=u(()=>o("label",{for:"dba"},"DBA",-1)),ze={class:"field"},He=u(()=>o("label",{for:"name"},"Contractor Name",-1)),Ye={class:"field"},Ge=u(()=>o("label",{for:"phone"},"Cell Phone",-1)),Je={class:"field"},Xe=u(()=>o("label",{for:"email"},"Email",-1)),Ke={key:0,class:"error"},Qe={class:"field"},Ze=u(()=>o("label",{for:"muni"},"Municipality",-1)),eo={class:"field"},oo=u(()=>o("label",{for:"folio"},"Folio",-1)),ao={class:"field"},lo=u(()=>o("label",{for:"permit"},"Master Permit",-1)),so={class:"field"},to=u(()=>o("label",{for:"processnum"},"mEProcess #",-1)),no={key:0,class:"response span-2"},io={class:"span-2 submit-row"},uo={__name:"PermitApp",setup(r){const p=a(!1),v=a(""),k=a(!1);a(!1);const f=a(!1);de(),we();const{procReceive:A}=ie(),{accountUsers:d}=Ie(),h=Ue(),{callPermitdata:x}=Be(),_=a([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),H=a("me");$(()=>{const{width:s,isUltraWide:e,height:c,isLongScreen:m}=ke();return console.log(s,e),{width:s,isUltraWide:e,height:c,isLongScreen:m}});const l=ce({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",phNumber:"",emails:"",muniProc:"",historic:Boolean,date:new Date,checkIfBeach:0}),b=a(""),Y=a(""),G=a(!0),D=a(!1),y=a(""),w=a(""),g=a(""),C=a(""),I=a(""),V=a([]),U=a(""),j=a(!1);$(()=>{var s;j.value===!1&&((s=d.value[0])==null?void 0:s.secondary_status)==="I"?(console.log(j.value),alert("Your license is Inactive!")):j.value=!0}),me(()=>{E(),k.value=!0,localStorage.clear()});const J=q(()=>{var s,e;return((s=d.value[0])==null?void 0:s.bphone)!==""&&(D.value=!0,g.value=d.value[0].bphone,console.log(g.value)),D.value===!0?g.value:(e=d.value[0])==null?void 0:e.bphone});pe(E,J,()=>{});async function E(){var s,e,c,m,i;V.value=await d.value[0],C.value=((s=V.value)==null?void 0:s.name)||"",I.value=((e=V.value)==null?void 0:e.email)||"",y.value=((c=V.value)==null?void 0:c.secondary_status)||"",console.log(y.value),w.value=((m=V.value)==null?void 0:m.dba)||"",g.value=(i=d.value[0])==null?void 0:i.bphone}ve(async()=>{await ye(D).toBe(!0)});const F=q(()=>G.value?_.value[0]:""),{resNum:X}=ue(),L=a(""),N=a(null),P=a(""),O=a(null),R=a(""),T=a(null);async function K(s){p.value=!0,O.value=null;try{const e=await fetch(s);N.value=await e.json(),P.value=N.value.body.MinimumPropertyInfos[0],l.contractor=P.value.dba,l.license=P.value.secondary_status,l.muni=P.value.Municipality,l.folio=P.value.Strap,console.log(N.value),f.value=await N.value.body.isHistoric,console.log(f.value),L.value=l.folio}catch(e){alert("No data found or enter correct address!"),O.value=e.message}finally{p.value=!1}}async function Q(s){const e=s.value;console.log(s.value,e),s.value===2&&(l.checkIfBeach=s.value,console.log("Updated mbId:",l.checkIfBeach))}async function Z(){try{p.value=!0,Y.value=b.value;const e=`https://6x2kydgvuahfitwvxkkfbybv6u0kbxgl.lambda-url.us-east-1.on.aws/?address=${U.value.toUpperCase()}`;await K(e),Object.assign(l,{license:y.value,contractor:w.value,emails:I.value,muniProc:b.value,phNumber:g.value});const c=String(X.value).substring(3,19),m=z(c).value+1;l.processNumber=H.value.concat(String(m)),l.muniProc=b.value,l.address=U.value,R.value=L.value.substring(1,2),T.value=z(R),Q(T.value),h.addSystem(l),await A(l),await x(l)}catch(s){alert(s)}}async function ee(){h.addSystem(l,mbId)}function oe(){h.addSystem(l,mbId),console.log(h)}return(s,e)=>{const c=re,m=ne,i=te,W=se,ae=le;return S(),M(be,null,[k.value?(S(),fe(c,{key:0})):B("",!0),o("section",Ae,[o("div",xe,[De,n(m,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=t=>F.value=t),options:_.value,optionLabel:"name",placeholder:"Select a permit type",class:"w-full permit-select"},null,8,["modelValue","options"]),o("form",{class:"grid-form",onSubmit:he(ee,["prevent"])},[o("div",Ce,[je,n(i,{id:"license",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),placeholder:"active / inactive"},null,8,["modelValue"])]),o("div",Ee,[Fe,n(i,{id:"processMuni",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),placeholder:"00000000"},null,8,["modelValue"])]),o("div",Le,[Oe,o("div",Re,[n(i,{id:"addr",modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=t=>U.value=t),placeholder:"123 SW 1st St"},null,8,["modelValue"]),n(W,{type:"button",icon:"pi pi-search",loading:p.value,onClick:Z},null,8,["loading"])])]),o("div",Te,[f.value?(S(),M("span",We,"Property is Historic")):B("",!0)]),o("div",$e,[qe,n(i,{id:"dba",modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=t=>w.value=t),placeholder:"company alias"},null,8,["modelValue"])]),o("div",ze,[He,n(i,{id:"name",modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=t=>C.value=t),placeholder:"full name"},null,8,["modelValue"])]),o("div",Ye,[Ge,n(ae,{id:"phone",modelValue:l.phNumber,"onUpdate:modelValue":e[6]||(e[6]=t=>l.phNumber=t),mask:"(999) 999-9999",placeholder:"(999) 999-9999"},null,8,["modelValue"])]),o("div",Je,[Xe,n(i,{id:"email",modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=t=>I.value=t),invalid:s.invalid,placeholder:"you@example.com"},null,8,["modelValue","invalid"]),s.invalid?(S(),M("small",Ke,"Email is required")):B("",!0)]),o("div",Qe,[Ze,n(i,{id:"muni",modelValue:l.muni,"onUpdate:modelValue":e[8]||(e[8]=t=>l.muni=t),placeholder:"Miami"},null,8,["modelValue"])]),o("div",eo,[oo,n(i,{id:"folio",modelValue:l.folio,"onUpdate:modelValue":e[9]||(e[9]=t=>l.folio=t),placeholder:"00-0000-000-0000",onInput:s.updatemEProcess},null,8,["modelValue","onInput"])]),o("div",ao,[lo,n(i,{id:"permit",modelValue:l.permit,"onUpdate:modelValue":e[10]||(e[10]=t=>l.permit=t),placeholder:"20000000"},null,8,["modelValue"])]),o("div",so,[to,n(i,{id:"processnum",modelValue:l.processNumber,"onUpdate:modelValue":e[11]||(e[11]=t=>l.processNumber=t),placeholder:"auto-generated"},null,8,["modelValue"])]),v.value?(S(),M("p",no,_e(v.value),1)):B("",!0),o("div",io,[n(W,{label:"Submit",type:"submit",loading:p.value,severity:"contrast",raised:"",as:"router-link",to:"/roofsystem",onUpdate:oe},null,8,["loading"])])],32)])])],64)}}},Bo=Ne(uo,[["__scopeId","data-v-0a6e14d0"]]);export{Bo as default};
