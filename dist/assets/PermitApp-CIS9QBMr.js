import{r as n,E as Z,f as $,Q as F,am as ee,as as O,j as oe,p as g,s as N,q as A,a5 as I,u as e,A as d,H as te,G as ae,a4 as le,F as se,al as ne,at as ie,a6 as re,W as de,V as ce,a7 as ue,aC as me,ap as pe,_ as fe,$ as ge,a0 as be}from"./vue-vendor-DzAkcJj_.js";import{_ as ve}from"./FileSaver-Bn3pcHYx.js";import{u as _e,a as he,b as z,_ as ye}from"./use-createProcessnumber-hATryJLx.js";import{u as we}from"./accountsStore-wlHGd0qN.js";import{u as Ve}from"./permitapp-DylJ2Cp4.js";import{am as Se,ap as xe,aq as Pe}from"./vendor-BRFOvblm.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./processStore-OMUL4zMW.js";import"./lodash-bvFwl9iN.js";n(1);const Ue={setup(){const l=n(""),o=Z(),_=n(!1),a=n(),C=n(),D=n(),{procData:M,procReceive:h}=_e(),{accountUsers:s,getUser:y,addUser:V}=we();console.log(s._value[0]);const S=n("me"),x=Ve(),r=$({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",date:new Date}),t=n(""),R=n(""),P=n(""),E=n(""),B=n("");F(()=>{Se.init({duration:800,easing:"ease-in-out",once:!0})}),ee(()=>{if(s._value[0].name==="")return o.push("/");_.value=!0,t.value=s._value[0].name,R.value=s._value[0].email,P.value=s._value[0].phone,E.value=s._value[0].secondary_status,B.value=s._value[0].dba,console.log(s._value[0].phone)});const k=n(!1),L=n(!1);he();const{lastNum:w,resNum:T}=z();P.value=s._value[0].phone,n(null);const b=n(""),U=n("");F(()=>{_.value=!0});const W=async()=>{try{const u=n(r.address),v=`https://www.miamidade.gov/Apps/PA/PApublicServiceProxy/PaServicesProxy.ashx?Operation=GetAddress&clientAppName=PropertySearch&myUnit=&from=1&myAddress=${encodeURIComponent(u.value)}&to=200`,p=await fetch(v);L.value=!0;const i=await p.json();console.log(i),r.muni=i.MinimumPropertyInfos[0].Municipality,r.license=s._value[0].license,r.contractor=s._value[0].name,r.folio=i.MinimumPropertyInfos[0].Strap;let m=String(w.value);console.log(w.value.length,w.value,m);let K=m.substring(2,13),X=ne(K).value+1,Y=String(X);r.processNumber=S.value.concat(Y),console.log(r.processNumber),U.value=r.folio,b.value=U.value.substring(1,2),console.log(b.value),h(r),setTimeout(()=>{L.value=!1},2e3)}catch(u){alert(u)}},q=async()=>{h(r)},G=n(),H=n([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),Q=()=>{o.push("/roofsystem")};function J(u,f){u=r,f=G.value,u.length!==0&&(x.addSystem(u,f,b.value),k.value=!0,console.log(u,f,b.value,"System added"))}const j=()=>{const u=document.getElementById("permitapp");console.log(u),xe(u).then(v=>{const p=v.toDataURL("image/png"),i=new Pe;i.text(`${r.processNumber}`,20,30),i.setGState(new i.GState({opacity:.4})),i.setFontSize(24),i.setTextColor(150,150,150),i.text("DigitalSolutions",i.internal.pageSize.getWidth()/2,i.internal.pageSize.getHeight()/2,{angle:0,align:"left",baseline:"bottom",renderingMode:"fill"}),console.log(i.text),i.addImage(p,"PNG",10,10,190,0),i.setGState(new i.GState({opacity:1}));const m=i.output("blob");console.log(m),f(m)});const f=async v=>{try{const p=v,i=new Blob([p],{type:"application/pdf"}),m=document.createElement("a");m.href=URL.createObjectURL(i),m.download=`${r.processNumber}-permitapp.pdf`,m.click(),URL.revokeObjectURL(m.href),console.log("PDF saved successfully without popping download dialog!")}catch(p){console.error("Error saving file:",p)}}};return O(async()=>{await ie(k).changed(),j()}),{isDialog:_,pdfcleared:k,generatePdf:j,onSubmit:q,accountUsers:s,getUser:y,email:R,dba:B,invoke:O,phone:P,contractor:t,licenseStatus:E,addUser:V,navigateNext:Q,addItemAndClear:J,selectedApplication:G,type:H,resNum:T,...oe(r),responseMessage:l,lastNum:w,useLast:z,load:W,checkMB:b,checkV:U,content:a,canvas:C,doc:D}}},c=l=>(fe("data-v-2aaaa450"),l=l(),ge(),l),Ne={class:"md:w-3/4"},Ae={class:"container md:w-3/4",style:{"margin-left":"220px"}},Ie={class:"row"},Ce={class:"card flex flex-col gap-1"},De=c(()=>e("div",{class:"font-semibold text-xl"},"Permit Application",-1)),Me={class:"card flex justify-center"},Re={class:"flex flex-col mt-3 grow basis-0 gap-3",style:{"max-width":"300px"}},Ee=c(()=>e("label",{for:"license"},"License Status",-1)),Be={class:"card flex flex-col gap-2"},Le={class:"flex flex-col grow basis-0 gap-2"},Ge=c(()=>e("label",{for:"addr"},"Property Address",-1)),je={key:1,class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},Fe={class:"flex flex-col mt-3 grow basis-0 gap-3"},Oe=c(()=>e("label",{for:"dba"},"DBA ",-1)),ze={class:"flex flex-col mt-3 grow basis-0 gap-3"},Te=c(()=>e("label",{for:"contractor"},"Contractor Name",-1)),We={class:"flex flex-col mt-3 grow basis-0 gap-3"},qe=c(()=>e("label",{for:"phone"},"Cell Phone Number",-1)),He={class:"flex flex-col mt-3 grow basis-0 gap-3"},Qe=c(()=>e("label",{for:"Email"},"Email",-1)),Je={class:"flex flex-col mt-3 grow basis-0 gap-3"},Ke=c(()=>e("label",{for:"muni"},"Municipality",-1)),Xe={class:"flex flex-col mt-3 grow basis-0 gap-3"},Ye=c(()=>e("label",{for:"folio"},"Folio",-1)),Ze={class:"flex flex-col mt-3 grow basis-0 gap-3"},$e=c(()=>e("label",{for:"permit"},"Master Permit",-1)),eo={class:"flex flex-col mt-3 grow basis-0 gap-3"},oo=c(()=>e("label",{for:"processnum"},"mEProcess Number",-1)),to={key:0},ao=c(()=>e("br",null,null,-1)),lo=c(()=>e("br",null,null,-1)),so={"data-aos":"fade-up-right","data-aos-delay":"500"};function no(l,o,_,a,C,D){const M=ye,h=re,s=de,y=ce,V=ue,S=me,x=ve,r=be;return g(),N(se,null,[a.isDialog?(g(),A(M,{key:0})):I("",!0),e("div",Ne,[e("div",Ae,[e("form",null,[e("div",Ie,[e("div",Ce,[De,e("div",Me,[d(h,{modelValue:a.selectedApplication,"onUpdate:modelValue":o[0]||(o[0]=t=>a.selectedApplication=t),options:a.type,showClear:"",optionLabel:"name",placeholder:"Select a permit type",class:"w-full md:w-56"},null,8,["modelValue","options"])]),e("div",Re,[Ee,d(s,{id:"license",modelValue:a.licenseStatus,"onUpdate:modelValue":o[1]||(o[1]=t=>a.licenseStatus=t),type:"text",placeholder:"name"},null,8,["modelValue"])]),e("div",Be,[e("form",{class:"w-3/4",onSubmit:o[12]||(o[12]=(...t)=>a.onSubmit&&a.onSubmit(...t))},[e("div",Le,[Ge,te(d(s,{id:"addr",type:"text",modelValue:l.address,"onUpdate:modelValue":o[2]||(o[2]=t=>l.address=t),placeholder:"address"},null,8,["modelValue"]),[[r,"Make sure that either street or avenue is spelled out, direction could be shorten (sw)",void 0,{top:!0}]]),l.loading?(g(),N("i",je)):(g(),A(y,{key:0,id:"search",type:"button",label:"Search",class:"w-1/3",style:{"background-color":"#a4b5b9"},raised:"",icon:"pi pi-search-plus",loading:l.loading,onClick:a.load,onInput:l.createHtml},null,8,["loading","onClick","onInput"]))]),e("div",Fe,[Oe,d(s,{id:"dba",modelValue:a.dba,"onUpdate:modelValue":o[3]||(o[3]=t=>a.dba=t),type:"text",placeholder:"name"},null,8,["modelValue"])]),e("div",ze,[Te,d(s,{id:"contractor",modelValue:a.contractor,"onUpdate:modelValue":o[4]||(o[4]=t=>a.contractor=t),type:"text",placeholder:"name"},null,8,["modelValue"])]),e("div",We,[qe,d(V,{modelValue:a.phone,"onUpdate:modelValue":o[5]||(o[5]=t=>a.phone=t),mask:"(999) 999-9999",placeholder:"(999) 999-9999",invalid:a.phone===""},null,8,["modelValue","invalid"])]),e("div",He,[Qe,d(s,{modelValue:a.email,"onUpdate:modelValue":o[6]||(o[6]=t=>a.email=t),invalid:a.email===null,error:l.emailError},null,8,["modelValue","invalid","error"]),l.invalid?(g(),A(S,{key:0,severity:"error"},{default:ae(()=>[pe("Email is required")]),_:1})):I("",!0)]),e("div",Je,[Ke,d(s,{id:"muni",modelValue:l.muni,"onUpdate:modelValue":o[7]||(o[7]=t=>l.muni=t),type:"text",placeholder:"municipality"},null,8,["modelValue"])]),e("div",Xe,[Ye,d(s,{id:"folio",modelValue:l.folio,"onUpdate:modelValue":o[8]||(o[8]=t=>l.folio=t),type:"text",placeholder:"folio",onInput:l.updatemEProcess},null,8,["modelValue","onInput"])]),e("div",Ze,[$e,d(s,{id:"permit",modelValue:l.permit,"onUpdate:modelValue":o[9]||(o[9]=t=>l.permit=t),type:"text",placeholder:"20000000"},null,8,["modelValue"])]),e("div",eo,[oo,d(s,{id:"processnum",modelValue:l.processNumber,"onUpdate:modelValue":o[10]||(o[10]=t=>l.processNumber=t),type:"text",placeholder:"process number"},null,8,["modelValue"])]),a.responseMessage?(g(),N("p",to,le(a.responseMessage),1)):I("",!0),ao,d(y,{id:"submit",type:"submit",label:"Submit",class:"w-1/3",style:{"background-color":"#a4b5b9"},raised:"",as:"router-link",to:"/roofsystem",onClick:o[11]||(o[11]=t=>a.addItemAndClear(l.formData,a.selectedApplication)),onChange:a.generatePdf},null,8,["onChange"])],32),lo,e("div",so,[d(x)])])])])])])])],64)}const _o=ke(Ue,[["render",no],["__scopeId","data-v-2aaaa450"]]);export{_o as default};
