import{s as se}from"./index-UqIW6e8H.js";import{s as te}from"./index-DCUMda4r.js";import{s as ne}from"./index-BV5xBKtM.js";import{s as ie}from"./index-BosbpSH4.js";import{u as ue,a as re,_ as de}from"./use-createProcessnumber-Dh6WrEJU.js";import{e as a,u as ce,h as H,f as me,Y as pe,I as Y,ac as ve,ad as fe,o as w,c as A,a as _e,d as x,i as o,j as n,J as he,t as be,F as ye,af as ge,X as G,p as Ve,q as Pe}from"./index-Dlrv6ri-.js";import{u as Se,a as we}from"./useAxios-BTTrZHJh.js";import{u as ke}from"./useScreenSize-B_5Kyo0O.js";import{u as Ne}from"./processStore-Bg3RVvIY.js";import{u as Ue}from"./accountsStore-jSnWuUu5.js";import{u as Me}from"./permitapp-ucx1nbiC.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Brxa_QJX.js";import"./index-qd9jIHjF.js";import"./index-CSy35stl.js";import"./index-DiLQ0B7c.js";import"./index-Cjp6xjy6.js";import"./index-CTwL4b73.js";import"./index-DSitCy1e.js";const Ae="https://mg7y3qizyjvkkwd7ynpoc2r2yi0gerzh.lambda-url.us-east-1.on.aws/";function xe(){const r=a(!1),d=a(null),_=a(null),{data:k,error:y,isFetching:F,execute:B}=Se(Ae,{method:"POST",headers:{"Content-Type":"application/json"}},we,{immediate:!1});return{data:k,errors:d,isFetching:F,loading:r,callPermitdata:async h=>{_.value=h,console.log(_.value),r.value=!0,y.value=null;try{return await B({data:_.value})}catch(N){y.value=N.massage,console.error("Lambda post failed:",N)}finally{r.value=!1}}}}const u=r=>(Ve("data-v-899c441b"),r=r(),Pe(),r),Be={class:"hero"},De={class:"card"},Ce=u(()=>o("h1",{class:"title"},"Permit Application",-1)),je={class:"field"},Ee=u(()=>o("label",{for:"license"},"License Status",-1)),Le={class:"field"},Te=u(()=>o("label",{for:"processMuni"},"Municipality Process #",-1)),Fe={class:"field"},Oe=u(()=>o("label",{for:"addr"},"Property Address",-1)),Re={class:"input-row"},We={class:"field"},$e={key:0,class:"historic-indicator"},qe={class:"field"},ze=u(()=>o("label",{for:"dba"},"DBA",-1)),He={class:"field"},Ye=u(()=>o("label",{for:"name"},"Contractor Name",-1)),Ge={class:"field"},Je=u(()=>o("label",{for:"phone"},"Cell Phone",-1)),Xe={class:"field"},Ke=u(()=>o("label",{for:"email"},"Email",-1)),Qe={key:0,class:"error"},Ze={class:"field"},eo=u(()=>o("label",{for:"muni"},"Municipality",-1)),oo={class:"field"},ao=u(()=>o("label",{for:"folio"},"Folio",-1)),lo={class:"field"},so=u(()=>o("label",{for:"permit"},"Master Permit",-1)),to={class:"field"},no=u(()=>o("label",{for:"processnum"},"mEProcess #",-1)),io={key:0,class:"response span-2"},uo={class:"span-2 submit-row"},ro={__name:"PermitApp",setup(r){const d=a(!1),_=a(""),k=a(!1),y=a(!1);ce(),Ne();const{procData:F,procReceive:B}=ue(),{accountUsers:p}=Ue(),h=Me(),{callPermitdata:N}=xe(),O=a([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),J=a("me");H(()=>{const{width:t,isUltraWide:e,height:c,isLongScreen:m}=ke();return console.log(t,e),{width:t,isUltraWide:e,height:c,isLongScreen:m}});const l=me({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",phNumber:"",emails:"",muniProc:"",historic:Boolean,date:new Date}),v=a(""),D=a(""),X=a(!0),C=a(!1),g=a(""),U=a(""),V=a(""),j=a(""),M=a(""),P=a([]),f=a(""),E=a(!1);H(()=>{var t;E.value===!1&&((t=p.value[0])==null?void 0:t.secondary_status)==="I"?(console.log(E.value),alert("Your license is Inactive!")):E.value=!0}),pe(()=>{R(),k.value=!0,localStorage.clear()});const K=Y(()=>{var t,e;return((t=p.value[0])==null?void 0:t.bphone)!==""&&(C.value=!0,V.value=p.value[0].bphone,console.log(V.value)),C.value===!0?V.value:(e=p.value[0])==null?void 0:e.bphone});ve(R,K,()=>{});async function R(){var t,e,c,m,i;P.value=await p.value[0],j.value=((t=P.value)==null?void 0:t.name)||"",M.value=((e=P.value)==null?void 0:e.email)||"",g.value=((c=P.value)==null?void 0:c.secondary_status)||"",console.log(g.value),U.value=((m=P.value)==null?void 0:m.dba)||"",V.value=(i=p.value[0])==null?void 0:i.bphone}fe(async()=>{await ge(C).toBe(!0)});const I=Y(()=>X.value?O.value[0]:""),{resNum:Q}=re(),L=a(""),W=a(""),T=a(null),b=a(""),$=a(null),S=a(""),q=a(null);async function Z(t){d.value=!0,$.value=null;try{const e=await fetch(t);T.value=await e.json(),b.value=T.value.body.MinimumPropertyInfos[0],console.log(b.value),l.contractor=b.value.dba,l.license=b.value.secondary_status,l.muni=b.value.Municipality,l.folio=b.value.Strap,y.value=await T.value.body.isHistoric,W.value=l.folio,S.value=W.value.substring(1,2),L.value=G(S),console.log(S.value),S.value==="2"&&(q.value=S.value,console.log(q.value))}catch(e){alert("No data found or enter correct address!"),$.value=e.message}finally{d.value=!1}}async function ee(){try{d.value=!0,setTimeout(()=>d.value=!1,1e3),D.value=v.value;const e=`https://6x2kydgvuahfitwvxkkfbybv6u0kbxgl.lambda-url.us-east-1.on.aws/?address=${f.value}`;await Z(e),Object.assign(l,{license:g.value,contractor:U.value,emails:M.value,muniProc:v.value,phNumber:V.value});const c=String(Q.value).substring(3,19),m=G(c).value+1;l.processNumber=J.value.concat(String(m)),l.muniProc=v.value,l.address=f.value,h.addSystem(l),await B(l),await N(l)}catch(t){alert(t)}}async function oe(){h.addSystem(l,I.value,L.value,v.value,D.value,f.value)}function ae(){console.log(f.value),h.addSystem(l,I.value,L.value,v.value,D.value,f.value),console.log(h)}return(t,e)=>{const c=de,m=ie,i=ne,z=te,le=se;return w(),A(ye,null,[k.value?(w(),_e(c,{key:0})):x("",!0),o("section",Be,[o("div",De,[Ce,n(m,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=s=>I.value=s),options:O.value,optionLabel:"name",placeholder:"Select a permit type",class:"w-full permit-select"},null,8,["modelValue","options"]),o("form",{class:"grid-form",onSubmit:he(oe,["prevent"])},[o("div",je,[Ee,n(i,{id:"license",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),placeholder:"active / inactive"},null,8,["modelValue"])]),o("div",Le,[Te,n(i,{id:"processMuni",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=s=>v.value=s),placeholder:"00000000"},null,8,["modelValue"])]),o("div",Fe,[Oe,o("div",Re,[n(i,{id:"addr",modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=s=>f.value=s),placeholder:"123 SW 1st St"},null,8,["modelValue"]),n(z,{type:"button",icon:"pi pi-search",loading:d.value,onClick:ee},null,8,["loading"])])]),o("div",We,[y.value?(w(),A("span",$e,"Property is Historic")):x("",!0)]),o("div",qe,[ze,n(i,{id:"dba",modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=s=>U.value=s),placeholder:"company alias"},null,8,["modelValue"])]),o("div",He,[Ye,n(i,{id:"name",modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=s=>j.value=s),placeholder:"full name"},null,8,["modelValue"])]),o("div",Ge,[Je,n(le,{id:"phone",modelValue:l.phNumber,"onUpdate:modelValue":e[6]||(e[6]=s=>l.phNumber=s),mask:"(999) 999-9999",placeholder:"(999) 999-9999"},null,8,["modelValue"])]),o("div",Xe,[Ke,n(i,{id:"email",modelValue:M.value,"onUpdate:modelValue":e[7]||(e[7]=s=>M.value=s),invalid:t.invalid,placeholder:"you@example.com"},null,8,["modelValue","invalid"]),t.invalid?(w(),A("small",Qe,"Email is required")):x("",!0)]),o("div",Ze,[eo,n(i,{id:"muni",modelValue:l.muni,"onUpdate:modelValue":e[8]||(e[8]=s=>l.muni=s),placeholder:"Miami"},null,8,["modelValue"])]),o("div",oo,[ao,n(i,{id:"folio",modelValue:l.folio,"onUpdate:modelValue":e[9]||(e[9]=s=>l.folio=s),placeholder:"00-0000-000-0000",onInput:t.updatemEProcess},null,8,["modelValue","onInput"])]),o("div",lo,[so,n(i,{id:"permit",modelValue:l.permit,"onUpdate:modelValue":e[10]||(e[10]=s=>l.permit=s),placeholder:"20000000"},null,8,["modelValue"])]),o("div",to,[no,n(i,{id:"processnum",modelValue:l.processNumber,"onUpdate:modelValue":e[11]||(e[11]=s=>l.processNumber=s),placeholder:"auto-generated"},null,8,["modelValue"])]),_.value?(w(),A("p",io,be(_.value),1)):x("",!0),o("div",uo,[n(z,{label:"Submit",type:"submit",loading:d.value,severity:"contrast",raised:"",as:"router-link",to:"/roofsystem",onUpdate:ae},null,8,["loading"])])],32)])])],64)}}},Ao=Ie(ro,[["__scopeId","data-v-899c441b"]]);export{Ao as default};
