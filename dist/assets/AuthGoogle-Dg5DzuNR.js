import{s as q}from"./index-DryfAUML.js";import{u as A}from"./accountsStore-D9T6NtuY.js";import{u as G}from"./useAxios-cqGI49ol.js";import{e as s,j as b,f as N,u as S,w as T,k as I,o as k,c as y,g as m,h as U,l as x,p as r,a as D,d as C,t as V,q as j}from"./index-Chc17Abb.js";import{u as z}from"./auth-BUjBPPWr.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BkIq-rYG.js";function R(){const i=s(null),l=s(null);let u=null;const a=s([]);let p=b({});const t=b({dba:"",email:"",cphone:"",bphone:"",expiration_date:"",name:"",projects:[],secondary_status:"",license:"",phone:""}),g=s(null),{addUser:f}=A();N(()=>{u=google.accounts.oauth2.initTokenClient({client_id:"978320609817-r83rgg9qsb4ntam9dek995cqcn779qut.apps.googleusercontent.com",scope:["openid","email","profile","https://www.googleapis.com/auth/gmail.readonly"].join(" "),callback:h})});const v=()=>u.requestAccessToken({prompt:"consent"},w()),_=()=>{i.value&&google.accounts.oauth2.revoke(i.value,()=>{i.value=null,l.value=null})};async function w(){let n="https://us-east-1.aws.data.mongodb-api.com/app/data-aquwo/endpoint/getaccounts";const{execute:o,then:c,data:e}=G(n,{method:"GET"},{immediate:!1});let B=s([]);B.value=o().then(K=>{p=e.value;for(const[L,E]of Object.entries(p))a.value.push(E);console.log(a.value)})}async function h(n){if(n.error)return console.error(n);i.value=n.access_token;const o=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${n.access_token}`}}).then(c=>c.json());g.value=o.email,d(g)}async function d(n){var c;const o=await n.value;console.log(o);for(let e=0;e<=a.value[0].length;e++)await((c=a.value[0][e])==null?void 0:c.email)===o&&(t.email=await a.value[0][e].email,t.name=await a.value[0][e].name,t.dba=await a.value[0][e].dba,t.cphone=await a.value[0][e].cphone,t.bphone=await a.value[0][e].bphone,t.phone=await a.value[0][e].bphone,t.expiration_date=await a.value[0][e].expiration_date,t.projects=await a.value[0][e].projects,t.secondary_status=await a.value[0][e].secondary_status,t.license=await a.value[0][e].license,console.log(t),f(t))}return{accessToken:i,idPayload:l,signIn:v,signOut:_,checkEmail:d,localData:a,acctUser:t}}const P={class:"relative w-full h-screen overflow-hidden"},$={class:"relative z-10 flex items-center justify-center h-full bg-black/50"},M={style:{"border-radius":"20px",padding:"0.5rem"}},F={class:"container w-full py-15 px-8 sm:px-2"},H={key:0},J={__name:"AuthGoogle",setup(i){const{accessToken:l,idPayload:u,signIn:a,signOut:p,localData:t,acctUser:g}=R();s(!1);const f=S();s(!1);const v=s([]);z(),s([]);let _=b({dba:"",email:"",cphone:"",bphone:"",expiration_date:"",name:"",projects:[],secondary_status:"",license:"",phone:""});const{getUser:w}=A(),h=()=>{console.log(w),t.value.forEach((o,c)=>{for(let e=0;e<o.length;e++)l.value&&(v.value.push(o[e]),_.phone=o[e].bphone,d())})};function d(){n()}function n(){f.push("/permitapp")}return T(h,()=>{}),I(()=>{l.value&&fetch("https://gmail.googleapis.com/gmail/v1/users/me/messages?maxResults=4",{headers:{Authorization:`Bearer ${l.value}`}}).then(o=>o.json()).then(console.log)}),(o,c)=>{const e=q;return k(),y("div",P,[m("div",$,[m("div",M,[m("div",F,[m("div",null,[U(e,{id:"googleSignin",class:"p-button hover:bg-grey text-black",onClick:r(a),onChange:h,severity:"Contrast",raised:"",onInput:o.email},{default:x(()=>[j("Sign in with Google")]),_:1},8,["onClick","onInput"]),r(l)?(k(),D(e,{key:0,onClick:r(p)},{default:x(()=>[j("SignÂ out")]),_:1},8,["onClick"])):C("",!0)])]),r(u)?(k(),y("pre",H,V(r(u)),1)):C("",!0)])])])}}},te=O(J,[["__scopeId","data-v-b2111a04"]]);export{te as default};
