import{s as oe}from"./index-obfO-I2u.js";import{s as ae}from"./index-BqaFUQdR.js";import{s as se}from"./index-B147Xt8V.js";import{s as le}from"./index-CbYMHSIc.js";import{u as te,a as ne,_ as ie}from"./use-createProcessnumber-B_5ACq8G.js";import{e as t,f as x,h as re,g as T,Z as ue,I as W,ad as de,ae as ce,o as g,c as w,a as me,d as I,i as a,j as i,J as pe,t as ve,F as fe,af as he,Y as $,p as be,q as _e}from"./index-DEMr7LbH.js";import{u as ye,a as Ve}from"./useAxios-gb_fZ-n0.js";import{u as ge}from"./useScreenSize-CCT63i8s.js";import{u as Pe}from"./accountsStore-CTDD8bjj.js";import{u as Se}from"./permitapp-BrMwQs_R.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BNi3Vs9v.js";import"./index-CVAEi0Kd.js";import"./index-BGJQoqlc.js";import"./index-BU-sF8E5.js";import"./index-fp20SUJ-.js";import"./index-sXW-GQUL.js";import"./index-D1eQDzxN.js";import"./index-vgj0Ubvm.js";import"./processStore-DcbZ9-Tq.js";const we="https://mg7y3qizyjvkkwd7ynpoc2r2yi0gerzh.lambda-url.us-east-1.on.aws/";function Ie(){const c=t(!1),p=t(null),f=t(null),{data:P,error:h,isFetching:b,execute:U}=ye(we,{method:"POST",headers:{"Content-Type":"application/json"}},Ve,{immediate:!1});return{data:P,errors:p,isFetching:b,loading:c,callPermitdata:async _=>{f.value=_,c.value=!0,h.value=null;try{return await U({data:f.value})}catch(S){h.value=S.massage,console.error("Lambda post failed:",S)}finally{c.value=!1}}}}const r=c=>(be("data-v-63e26310"),c=c(),_e(),c),Ue={class:"hero"},Me={class:"card"},Ne=r(()=>a("h1",{class:"title"},"Permit Application",-1)),Ae={class:"field"},Be=r(()=>a("label",{for:"license"},"License Status",-1)),xe={class:"field"},De=r(()=>a("label",{for:"processMuni"},"Municipality Process #",-1)),je={class:"field"},Ce=r(()=>a("label",{for:"addr"},"Property Address",-1)),Ee={class:"input-row"},Fe={class:"field"},Le={key:0,class:"historic-indicator"},Oe={class:"field"},Re=r(()=>a("label",{for:"dba"},"DBA",-1)),Te={class:"field"},We=r(()=>a("label",{for:"name"},"Contractor Name",-1)),$e={class:"field"},qe=r(()=>a("label",{for:"phone"},"Cell Phone",-1)),ze={class:"field"},He=r(()=>a("label",{for:"email"},"Email",-1)),Ye={key:0,class:"error"},Ge={class:"field"},Je=r(()=>a("label",{for:"muni"},"Municipality",-1)),Ze={class:"field"},Ke=r(()=>a("label",{for:"folio"},"Folio",-1)),Qe={class:"field"},Xe=r(()=>a("label",{for:"permit"},"Master Permit",-1)),eo={class:"field"},oo=r(()=>a("label",{for:"processnum"},"mEProcess #",-1)),ao={key:0,class:"response span-2"},so={class:"span-2 submit-row"},lo={__name:"PermitApp",setup(c){const p=t(!1),f=t(""),P=t(!1),h=x({dba:"",jobaddress:"",municipality:"",muniprocessnumber:"",processnumber:"",masterpermit:"",license:""}),b=t(!1);re();const{procReceive:U}=te(),{accountUsers:v}=Pe(),_=Se(),{callPermitdata:S}=Ie(),D=t([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),q=t("me");T(()=>{const{width:l,isUltraWide:e,height:u,isLongScreen:m}=ge();return{width:l,isUltraWide:e,height:u,isLongScreen:m}});const o=x({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",phNumber:"",emails:"",muniProc:"",historic:Boolean,date:new Date,checkIfBeach:0}),y=t(""),z=t(""),H=t(!0),M=t(!1),n=x({licenseStat:"",dba:"",phone:"",name:"",email:""}),V=t([]),k=t(""),j=t(!1);T(()=>{var l;j.value===!1&&((l=v.value[0])==null?void 0:l.secondary_status)==="I"?(o.license="Inactive",alert("Your license is Inactive!")):(o.license="Active",j.value=!0)}),ue(()=>{N(),P.value=!0,localStorage.clear()});const Y=W(()=>{var l,e,u;return((l=v.value[0])==null?void 0:l.bphone)!==""&&(M.value=!0,phone.value=(e=v.value[0])==null?void 0:e.bphone),M.value===!0?phone.value:(u=v.value[0])==null?void 0:u.bphone});de(N,Y,()=>{console.log(N)});async function N(){var l,e,u,m;V.value=v.value[0],n.name=((l=V.value)==null?void 0:l.name)||"",n.email=((e=V.value)==null?void 0:e.email)||"",n.dba=((u=V.value)==null?void 0:u.dba)||"",n.phone=((m=V.value)==null?void 0:m.cphone)||""}ce(async()=>{await he(M).toBe(!0)});const C=W(()=>H.value?D.value[0]:""),{resNum:G}=ne(),E=t(""),A=t(null),B=t(""),F=t(null),L=t(""),O=t(null);async function J(l){p.value=!0,F.value=null;try{const e=await fetch(l);A.value=await e.json(),B.value=A.value.body.MinimumPropertyInfos[0],o.contractor=n.dba,o.muni=B.value.Municipality,o.folio=B.value.Strap,b.value=await A.value.body.isHistoric,console.log(b.value),E.value=o.folio}catch(e){alert("No data found or enter correct address!"),F.value=e.message}finally{p.value=!1}}async function Z(l){l.value===2&&(o.checkIfBeach=l.value)}async function K(){try{p.value=!0,z.value=y.value;const e=`https://6x2kydgvuahfitwvxkkfbybv6u0kbxgl.lambda-url.us-east-1.on.aws/?address=${k.value.toUpperCase()}`;await J(e),Object.assign(o,{license:n.licenseStat,dba:n.dba,emails:n.email,muniprocessnumber:y.value,phonenumber:n.phone});const u=String(G.value).substring(3,19),m=$(u).value+1;o.processNumber=q.value.concat(String(m)),o.muniProc=y.value,o.address=k.value,Object.assign(h,{dba:o.contractor,jobaddress:o.address,municipality:o.muni,muniprocessnumber:o.muniProc,processnumber:o.processNumber,masterpermit:o.permit,license:o.license}),L.value=E.value.substring(1,2),O.value=$(L),Z(O.value),_.addSystem(o),await U(o),await S(h)}catch(l){alert(l)}}async function Q(){_.addSystem(o,mbId)}function X(){_.addSystem(o,mbId)}return(l,e)=>{const u=ie,m=le,d=se,R=ae,ee=oe;return g(),w(fe,null,[P.value?(g(),me(u,{key:0})):I("",!0),a("section",Ue,[a("div",Me,[Ne,i(m,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),options:D.value,optionLabel:"name",placeholder:"Select a permit type",class:"w-full permit-select"},null,8,["modelValue","options"]),a("form",{class:"grid-form",onSubmit:pe(Q,["prevent"])},[a("div",Ae,[Be,i(d,{id:"license",modelValue:o.license,"onUpdate:modelValue":e[1]||(e[1]=s=>o.license=s),placeholder:"active / inactive"},null,8,["modelValue"])]),a("div",xe,[De,i(d,{id:"processMuni",modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s),placeholder:"00000000"},null,8,["modelValue"])]),a("div",je,[Ce,a("div",Ee,[i(d,{id:"addr",modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=s=>k.value=s),placeholder:"123 SW 1st St"},null,8,["modelValue"]),i(R,{type:"button",icon:"pi pi-search",loading:p.value,onClick:K},null,8,["loading"])])]),a("div",Fe,[b.value?(g(),w("span",Le,"Property is Historic")):I("",!0)]),a("div",Oe,[Re,i(d,{id:"dba",modelValue:n.dba,"onUpdate:modelValue":e[4]||(e[4]=s=>n.dba=s),placeholder:"company alias"},null,8,["modelValue"])]),a("div",Te,[We,i(d,{id:"name",modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=s=>n.name=s),placeholder:"full name"},null,8,["modelValue"])]),a("div",$e,[qe,i(ee,{id:"phone",modelValue:n.phone,"onUpdate:modelValue":e[6]||(e[6]=s=>n.phone=s),mask:"(999) 999-9999",placeholder:"(999) 999-9999"},null,8,["modelValue"])]),a("div",ze,[He,i(d,{id:"email",modelValue:n.email,"onUpdate:modelValue":e[7]||(e[7]=s=>n.email=s),invalid:l.invalid,placeholder:"you@example.com"},null,8,["modelValue","invalid"]),l.invalid?(g(),w("small",Ye,"Email is required")):I("",!0)]),a("div",Ge,[Je,i(d,{id:"muni",modelValue:o.muni,"onUpdate:modelValue":e[8]||(e[8]=s=>o.muni=s),placeholder:"Miami"},null,8,["modelValue"])]),a("div",Ze,[Ke,i(d,{id:"folio",modelValue:o.folio,"onUpdate:modelValue":e[9]||(e[9]=s=>o.folio=s),placeholder:"00-0000-000-0000",onInput:l.updatemEProcess},null,8,["modelValue","onInput"])]),a("div",Qe,[Xe,i(d,{id:"permit",modelValue:o.permit,"onUpdate:modelValue":e[10]||(e[10]=s=>o.permit=s),placeholder:"20000000"},null,8,["modelValue"])]),a("div",eo,[oo,i(d,{id:"processnum",modelValue:o.processNumber,"onUpdate:modelValue":e[11]||(e[11]=s=>o.processNumber=s),placeholder:"auto-generated"},null,8,["modelValue"])]),f.value?(g(),w("p",ao,ve(f.value),1)):I("",!0),a("div",so,[i(R,{label:"Submit",type:"submit",loading:p.value,severity:"contrast",raised:"",as:"router-link",to:"/roofsystem",onUpdate:X},null,8,["loading"])])],32)])])],64)}}},Io=ke(lo,[["__scopeId","data-v-63e26310"]]);export{Io as default};
