import{s as le}from"./index-DMw71W1X.js";import{s as se}from"./index-BhqJBLOz.js";import{s as te}from"./index-BxOkU3YN.js";import{s as ne}from"./index-CcOyITN4.js";import{u as ie,a as ue,_ as re}from"./use-createProcessnumber-Bhh2-XgW.js";import{e as a,u as ce,h as $,f as de,Y as me,I as q,ac as pe,ad as ve,o as S,c as M,a as fe,d as B,i as o,j as n,J as he,t as _e,F as be,af as ye,X as z,p as ge,q as Ve}from"./index-qYAEF0tq.js";import{u as Pe,a as Se}from"./useAxios-CBOw-Q94.js";import{u as ke}from"./useScreenSize-DbaIHXHi.js";import{u as we}from"./processStore-DDYhT8Tv.js";import{u as Ie}from"./accountsStore-BJjGGRi9.js";import{u as Ne}from"./permitapp-C5aEZG4I.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Bmrj7dR9.js";import"./index-D4xplyIU.js";import"./index-DM8I1WUT.js";import"./index-BPwkO8Vn.js";import"./index-vTo3V-eZ.js";import"./index-BWWFzlpe.js";import"./index-EAdcNqGG.js";const Me="https://mg7y3qizyjvkkwd7ynpoc2r2yi0gerzh.lambda-url.us-east-1.on.aws/";function Be(){const r=a(!1),p=a(null),v=a(null),{data:k,error:f,isFetching:A,execute:c}=Pe(Me,{method:"POST",headers:{"Content-Type":"application/json"}},Se,{immediate:!1});return{data:k,errors:p,isFetching:A,loading:r,callPermitdata:async x=>{v.value=x,console.log(v.value),r.value=!0,f.value=null;try{return await c({data:v.value})}catch(_){f.value=_.massage,console.error("Lambda post failed:",_)}finally{r.value=!1}}}}const u=r=>(ge("data-v-1e489acf"),r=r(),Ve(),r),Ae={class:"hero"},xe={class:"card"},De=u(()=>o("h1",{class:"title"},"Permit Application",-1)),Ce={class:"field"},je=u(()=>o("label",{for:"license"},"License Status",-1)),Ee={class:"field"},Fe=u(()=>o("label",{for:"processMuni"},"Municipality Process #",-1)),Le={class:"field"},Oe=u(()=>o("label",{for:"addr"},"Property Address",-1)),Re={class:"input-row"},Te={class:"field"},We={key:0,class:"historic-indicator"},$e={class:"field"},qe=u(()=>o("label",{for:"dba"},"DBA",-1)),ze={class:"field"},He=u(()=>o("label",{for:"name"},"Contractor Name",-1)),Ye={class:"field"},Ge=u(()=>o("label",{for:"phone"},"Cell Phone",-1)),Je={class:"field"},Xe=u(()=>o("label",{for:"email"},"Email",-1)),Ke={key:0,class:"error"},Qe={class:"field"},Ze=u(()=>o("label",{for:"muni"},"Municipality",-1)),eo={class:"field"},oo=u(()=>o("label",{for:"folio"},"Folio",-1)),ao={class:"field"},lo=u(()=>o("label",{for:"permit"},"Master Permit",-1)),so={class:"field"},to=u(()=>o("label",{for:"processnum"},"mEProcess #",-1)),no={key:0,class:"response span-2"},io={class:"span-2 submit-row"},uo={__name:"PermitApp",setup(r){const p=a(!1),v=a(""),k=a(!1);a(!1);const f=a(!1);ce(),we();const{procReceive:A}=ie(),{accountUsers:c}=Ie(),h=Ne(),{callPermitdata:x}=Be(),_=a([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),H=a("me");$(()=>{const{width:s,isUltraWide:e,height:d,isLongScreen:m}=ke();return console.log(s,e),{width:s,isUltraWide:e,height:d,isLongScreen:m}});const l=de({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",phNumber:"",emails:"",muniProc:"",historic:Boolean,date:new Date,checkIfBeach:0}),b=a(""),Y=a(""),G=a(!0),D=a(!1),y=a(""),w=a(""),g=a(""),C=a(""),I=a(""),V=a([]),N=a(""),j=a(!1);$(()=>{var s;j.value===!1&&((s=c.value[0])==null?void 0:s.secondary_status)==="I"?(console.log(j.value),alert("Your license is Inactive!")):j.value=!0}),me(()=>{E(),k.value=!0,localStorage.clear()});const J=q(()=>{var s,e;return((s=c.value[0])==null?void 0:s.bphone)!==""&&(D.value=!0,g.value=c.value[0].bphone,console.log(g.value)),D.value===!0?g.value:(e=c.value[0])==null?void 0:e.bphone});pe(E,J,()=>{});async function E(){var s,e,d,m,i;V.value=await c.value[0],C.value=((s=V.value)==null?void 0:s.name)||"",I.value=((e=V.value)==null?void 0:e.email)||"",y.value=((d=V.value)==null?void 0:d.secondary_status)||"",console.log(y.value),w.value=((m=V.value)==null?void 0:m.dba)||"",g.value=(i=c.value[0])==null?void 0:i.bphone}ve(async()=>{await ye(D).toBe(!0)});const F=q(()=>G.value?_.value[0]:""),{resNum:X}=ue(),L=a(""),U=a(null),P=a(""),O=a(null),R=a(""),T=a(null);async function K(s){p.value=!0,O.value=null;try{const e=await fetch(s);U.value=await e.json(),P.value=U.value.body.MinimumPropertyInfos[0],l.contractor=P.value.dba,l.license=P.value.secondary_status,l.muni=P.value.Municipality,l.folio=P.value.Strap,console.log(U.value),f.value=await U.value.body.isHistoric,console.log(f.value),L.value=l.folio}catch(e){alert("No data found or enter correct address!"),O.value=e.message}finally{p.value=!1}}async function Q(s){const e=s.value;console.log(s.value,e),s.value===2&&(l.checkIfBeach=s.value,console.log("Updated mbId:",l.checkIfBeach))}async function Z(){try{p.value=!0,Y.value=b.value;const e=`https://6x2kydgvuahfitwvxkkfbybv6u0kbxgl.lambda-url.us-east-1.on.aws/?address=${N.value}`;await K(e),Object.assign(l,{license:y.value,contractor:w.value,emails:I.value,muniProc:b.value,phNumber:g.value});const d=String(X.value).substring(3,19),m=z(d).value+1;l.processNumber=H.value.concat(String(m)),l.muniProc=b.value,l.address=N.value,R.value=L.value.substring(1,2),T.value=z(R),Q(T.value),h.addSystem(l),await A(l),await x(l)}catch(s){alert(s)}}async function ee(){h.addSystem(l,mbId)}function oe(){h.addSystem(l,mbId),console.log(h)}return(s,e)=>{const d=re,m=ne,i=te,W=se,ae=le;return S(),M(be,null,[k.value?(S(),fe(d,{key:0})):B("",!0),o("section",Ae,[o("div",xe,[De,n(m,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=t=>F.value=t),options:_.value,optionLabel:"name",placeholder:"Select a permit type",class:"w-full permit-select"},null,8,["modelValue","options"]),o("form",{class:"grid-form",onSubmit:he(ee,["prevent"])},[o("div",Ce,[je,n(i,{id:"license",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),placeholder:"active / inactive"},null,8,["modelValue"])]),o("div",Ee,[Fe,n(i,{id:"processMuni",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),placeholder:"00000000"},null,8,["modelValue"])]),o("div",Le,[Oe,o("div",Re,[n(i,{id:"addr",modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=t=>N.value=t),placeholder:"123 SW 1st St"},null,8,["modelValue"]),n(W,{type:"button",icon:"pi pi-search",loading:p.value,onClick:Z},null,8,["loading"])])]),o("div",Te,[f.value?(S(),M("span",We,"Property is Historic")):B("",!0)]),o("div",$e,[qe,n(i,{id:"dba",modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=t=>w.value=t),placeholder:"company alias"},null,8,["modelValue"])]),o("div",ze,[He,n(i,{id:"name",modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=t=>C.value=t),placeholder:"full name"},null,8,["modelValue"])]),o("div",Ye,[Ge,n(ae,{id:"phone",modelValue:l.phNumber,"onUpdate:modelValue":e[6]||(e[6]=t=>l.phNumber=t),mask:"(999) 999-9999",placeholder:"(999) 999-9999"},null,8,["modelValue"])]),o("div",Je,[Xe,n(i,{id:"email",modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=t=>I.value=t),invalid:s.invalid,placeholder:"you@example.com"},null,8,["modelValue","invalid"]),s.invalid?(S(),M("small",Ke,"Email is required")):B("",!0)]),o("div",Qe,[Ze,n(i,{id:"muni",modelValue:l.muni,"onUpdate:modelValue":e[8]||(e[8]=t=>l.muni=t),placeholder:"Miami"},null,8,["modelValue"])]),o("div",eo,[oo,n(i,{id:"folio",modelValue:l.folio,"onUpdate:modelValue":e[9]||(e[9]=t=>l.folio=t),placeholder:"00-0000-000-0000",onInput:s.updatemEProcess},null,8,["modelValue","onInput"])]),o("div",ao,[lo,n(i,{id:"permit",modelValue:l.permit,"onUpdate:modelValue":e[10]||(e[10]=t=>l.permit=t),placeholder:"20000000"},null,8,["modelValue"])]),o("div",so,[to,n(i,{id:"processnum",modelValue:l.processNumber,"onUpdate:modelValue":e[11]||(e[11]=t=>l.processNumber=t),placeholder:"auto-generated"},null,8,["modelValue"])]),v.value?(S(),M("p",no,_e(v.value),1)):B("",!0),o("div",io,[n(W,{label:"Submit",type:"submit",loading:p.value,severity:"contrast",raised:"",as:"router-link",to:"/roofsystem",onUpdate:oe},null,8,["loading"])])],32)])])],64)}}},Mo=Ue(uo,[["__scopeId","data-v-1e489acf"]]);export{Mo as default};
