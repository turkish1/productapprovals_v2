import{s as oe}from"./index-D9oJW1A9.js";import{s as ae}from"./index-gyRO5pl3.js";import{s as se}from"./index-B5scfCvV.js";import{s as le}from"./index-CaHEOoRK.js";import{u as te,a as ne,_ as ie}from"./use-createProcessnumber-ChV-7xvT.js";import{e as t,f as x,h as re,g as T,Z as ue,I as W,ad as de,ae as ce,o as g,c as I,a as me,d as U,i as a,j as i,J as pe,t as ve,F as fe,af as he,Y as $,p as be,q as _e}from"./index-S2zFS6oH.js";import{u as ye,a as Ve}from"./useAxios-CF9Ajv2M.js";import{u as ge}from"./useScreenSize-dpfvLb03.js";import{u as Pe}from"./accountsStore-BgXMAUtn.js";import{u as Se}from"./permitapp-DIB473TV.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CHndqLn4.js";import"./index-CfQOfpbR.js";import"./index-BJYuqKxn.js";import"./index-qP_eki4p.js";import"./index-uQTpVM1J.js";import"./index-CmmrOgJm.js";import"./index-CDjR_Pm7.js";import"./index-B7u_ud_R.js";import"./processStore-By0elNl4.js";const we="https://mg7y3qizyjvkkwd7ynpoc2r2yi0gerzh.lambda-url.us-east-1.on.aws/";function Ie(){const c=t(!1),p=t(null),h=t(null),{data:P,error:b,isFetching:_,execute:M}=ye(we,{method:"POST",headers:{"Content-Type":"application/json"}},Ve,{immediate:!1});return{data:P,errors:p,isFetching:_,loading:c,callPermitdata:async y=>{h.value=y,c.value=!0,b.value=null;try{return await M({data:h.value})}catch(S){b.value=S.massage,console.error("Lambda post failed:",S)}finally{c.value=!1}}}}const u=c=>(be("data-v-830166f3"),c=c(),_e(),c),Ue={class:"hero"},Me={class:"card"},Ne=u(()=>a("h1",{class:"title"},"Permit Application",-1)),Ae={class:"field"},Be=u(()=>a("label",{for:"license"},"License Status",-1)),xe={class:"field"},De=u(()=>a("label",{for:"processMuni"},"Municipality Process #",-1)),je={class:"field"},Ce=u(()=>a("label",{for:"addr"},"Property Address",-1)),Ee={class:"input-row"},Fe={class:"field"},Le={key:0,class:"historic-indicator"},Oe={class:"field"},Re=u(()=>a("label",{for:"dba"},"DBA",-1)),Te={class:"field"},We=u(()=>a("label",{for:"name"},"Contractor Name",-1)),$e={class:"field"},qe=u(()=>a("label",{for:"phone"},"Cell Phone",-1)),ze={class:"field"},He=u(()=>a("label",{for:"email"},"Email",-1)),Ye={key:0,class:"error"},Ge={class:"field"},Je=u(()=>a("label",{for:"muni"},"Municipality",-1)),Ze={class:"field"},Ke=u(()=>a("label",{for:"folio"},"Folio",-1)),Qe={class:"field"},Xe=u(()=>a("label",{for:"permit"},"Master Permit",-1)),eo={class:"field"},oo=u(()=>a("label",{for:"processnum"},"mEProcess #",-1)),ao={key:0,class:"response span-2"},so={class:"span-2 submit-row"},lo={__name:"PermitApp",setup(c){const p=t(!1),h=t(""),P=t(!1),b=x({dba:"",jobaddress:"",municipality:"",muniprocessnumber:"",processnumber:"",masterpermit:"",license:""}),_=t(!1);re();const{procReceive:M}=te(),{accountUsers:v}=Pe(),y=Se(),{callPermitdata:S}=Ie(),D=t([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),q=t("me");T(()=>{const{width:l,isUltraWide:e,height:d,isLongScreen:m}=ge();return{width:l,isUltraWide:e,height:d,isLongScreen:m}});const o=x({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",phNumber:"",emails:"",muniProc:"",historic:Boolean,date:new Date,checkIfBeach:0}),V=t(""),z=t(""),H=t(!0),N=t(!1),n=x({licenseStat:"",dba:"",phone:"",name:"",email:""}),f=t([]),k=t(""),j=t(!1);T(()=>{var l;j.value===!1&&((l=v.value[0])==null?void 0:l.secondary_status)==="I"?alert("Your license is Inactive!"):j.value=!0}),ue(()=>{A(),P.value=!0,localStorage.clear()});const Y=W(()=>{var l,e,d;return((l=v.value[0])==null?void 0:l.bphone)!==""&&(N.value=!0,phone.value=(e=v.value[0])==null?void 0:e.bphone),N.value===!0?phone.value:(d=v.value[0])==null?void 0:d.bphone});de(A,Y,()=>{console.log(A)});async function A(){var l,e,d,m,r;f.value=v.value[0],n.name=((l=f.value)==null?void 0:l.name)||"",n.email=((e=f.value)==null?void 0:e.email)||"",n.licenseStat=((d=f.value)==null?void 0:d.secondary_status)||"",n.dba=((m=f.value)==null?void 0:m.dba)||"",n.phone=((r=f.value)==null?void 0:r.cphone)||""}ce(async()=>{await he(N).toBe(!0)});const C=W(()=>H.value?D.value[0]:""),{resNum:G}=ne(),E=t(""),B=t(null),w=t(""),F=t(null),L=t(""),O=t(null);async function J(l){p.value=!0,F.value=null;try{const e=await fetch(l);B.value=await e.json(),w.value=B.value.body.MinimumPropertyInfos[0],o.contractor=n.dba,o.license=w.value.secondary_status,o.muni=w.value.Municipality,o.folio=w.value.Strap,_.value=await B.value.body.isHistoric,console.log(_.value),E.value=o.folio}catch(e){alert("No data found or enter correct address!"),F.value=e.message}finally{p.value=!1}}async function Z(l){l.value===2&&(o.checkIfBeach=l.value)}async function K(){try{p.value=!0,z.value=V.value;const e=`https://6x2kydgvuahfitwvxkkfbybv6u0kbxgl.lambda-url.us-east-1.on.aws/?address=${k.value.toUpperCase()}`;await J(e),Object.assign(o,{license:n.licenseStat,dba:n.dba,emails:n.email,muniprocessnumber:V.value,phonenumber:n.phone});const d=String(G.value).substring(3,19),m=$(d).value+1;o.processNumber=q.value.concat(String(m)),o.muniProc=V.value,o.address=k.value,Object.assign(b,{dba:o.contractor,jobaddress:o.address,municipality:o.muni,muniprocessnumber:o.muniProc,processnumber:o.processNumber,masterpermit:o.permit,license:o.license}),L.value=E.value.substring(1,2),O.value=$(L),Z(O.value),y.addSystem(o),await M(o),await S(b)}catch(l){alert(l)}}async function Q(){y.addSystem(o,mbId)}function X(){y.addSystem(o,mbId)}return(l,e)=>{const d=ie,m=le,r=se,R=ae,ee=oe;return g(),I(fe,null,[P.value?(g(),me(d,{key:0})):U("",!0),a("section",Ue,[a("div",Me,[Ne,i(m,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),options:D.value,optionLabel:"name",placeholder:"Select a permit type",class:"w-full permit-select"},null,8,["modelValue","options"]),a("form",{class:"grid-form",onSubmit:pe(Q,["prevent"])},[a("div",Ae,[Be,i(r,{id:"license",modelValue:n.licenseStat,"onUpdate:modelValue":e[1]||(e[1]=s=>n.licenseStat=s),placeholder:"active / inactive"},null,8,["modelValue"])]),a("div",xe,[De,i(r,{id:"processMuni",modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s),placeholder:"00000000"},null,8,["modelValue"])]),a("div",je,[Ce,a("div",Ee,[i(r,{id:"addr",modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=s=>k.value=s),placeholder:"123 SW 1st St"},null,8,["modelValue"]),i(R,{type:"button",icon:"pi pi-search",loading:p.value,onClick:K},null,8,["loading"])])]),a("div",Fe,[_.value?(g(),I("span",Le,"Property is Historic")):U("",!0)]),a("div",Oe,[Re,i(r,{id:"dba",modelValue:n.dba,"onUpdate:modelValue":e[4]||(e[4]=s=>n.dba=s),placeholder:"company alias"},null,8,["modelValue"])]),a("div",Te,[We,i(r,{id:"name",modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=s=>n.name=s),placeholder:"full name"},null,8,["modelValue"])]),a("div",$e,[qe,i(ee,{id:"phone",modelValue:n.phone,"onUpdate:modelValue":e[6]||(e[6]=s=>n.phone=s),mask:"(999) 999-9999",placeholder:"(999) 999-9999"},null,8,["modelValue"])]),a("div",ze,[He,i(r,{id:"email",modelValue:n.email,"onUpdate:modelValue":e[7]||(e[7]=s=>n.email=s),invalid:l.invalid,placeholder:"you@example.com"},null,8,["modelValue","invalid"]),l.invalid?(g(),I("small",Ye,"Email is required")):U("",!0)]),a("div",Ge,[Je,i(r,{id:"muni",modelValue:o.muni,"onUpdate:modelValue":e[8]||(e[8]=s=>o.muni=s),placeholder:"Miami"},null,8,["modelValue"])]),a("div",Ze,[Ke,i(r,{id:"folio",modelValue:o.folio,"onUpdate:modelValue":e[9]||(e[9]=s=>o.folio=s),placeholder:"00-0000-000-0000",onInput:l.updatemEProcess},null,8,["modelValue","onInput"])]),a("div",Qe,[Xe,i(r,{id:"permit",modelValue:o.permit,"onUpdate:modelValue":e[10]||(e[10]=s=>o.permit=s),placeholder:"20000000"},null,8,["modelValue"])]),a("div",eo,[oo,i(r,{id:"processnum",modelValue:o.processNumber,"onUpdate:modelValue":e[11]||(e[11]=s=>o.processNumber=s),placeholder:"auto-generated"},null,8,["modelValue"])]),h.value?(g(),I("p",ao,ve(h.value),1)):U("",!0),a("div",so,[i(R,{label:"Submit",type:"submit",loading:p.value,severity:"contrast",raised:"",as:"router-link",to:"/roofsystem",onUpdate:X},null,8,["loading"])])],32)])])],64)}}},Io=ke(lo,[["__scopeId","data-v-830166f3"]]);export{Io as default};
