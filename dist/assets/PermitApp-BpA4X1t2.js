import{s as ae}from"./index-rLHnZH4T.js";import{s as le}from"./index-BJk3eT7L.js";import{s as se}from"./index-Ue8MmnOF.js";import{s as te}from"./index-BQUCMka9.js";import{u as ne,a as ie,_ as ue}from"./use-createProcessnumber-BOOg8DTu.js";import{e as a,u as re,h as z,f as de,_ as ce,K as H,ae as me,af as pe,o as P,c as U,a as ve,d as I,i as o,j as n,L as fe,t as _e,F as he,ah as be,Z as G,p as ye,q as Ve}from"./index-PV4IfQic.js";import{u as ge,a as Pe}from"./useAxios-60L-vhiw.js";import{u as Se}from"./useScreenSize-Bilt5xdw.js";import{u as we}from"./processStore-zM9SOT9k.js";import{u as ke}from"./accountsStore-Ck5sWur0.js";import{u as Ne}from"./permitapp-CuLdRTV7.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CfmA0_12.js";import"./index-DX7tNq1N.js";import"./index-I5UmVvT9.js";import"./index-B5Jz2m5G.js";import"./index-B36NO_ZK.js";import"./index-bUVW35S0.js";import"./index-Dw0tI9OO.js";const Ue="https://mg7y3qizyjvkkwd7ynpoc2r2yi0gerzh.lambda-url.us-east-1.on.aws/";function Ie(){const r=a(!1),d=a(null),v=a(null),{data:S,error:h,isFetching:C,execute:x}=ge(Ue,{method:"POST",headers:{"Content-Type":"application/json"}},Pe,{immediate:!1});return{data:S,errors:d,isFetching:C,loading:r,callPermitdata:async w=>{v.value=w,console.log(v.value),r.value=!0,h.value=null;try{return await x({data:v.value})}catch(k){h.value=k.massage,console.error("Lambda post failed:",k)}finally{r.value=!1}}}}const u=r=>(ye("data-v-458ffcc2"),r=r(),Ve(),r),xe={class:"hero"},Ae={class:"card"},Be=u(()=>o("h1",{class:"title"},"Permit Application",-1)),De={class:"field"},Le=u(()=>o("label",{for:"license"},"License Status",-1)),je={class:"field"},Ce=u(()=>o("label",{for:"processMuni"},"Municipality Process #",-1)),Ee={class:"field"},Te=u(()=>o("label",{for:"addr"},"Property Address",-1)),Fe={class:"input-row"},Oe={class:"field"},Re={key:0,class:"historic-indicator"},We={class:"field"},$e=u(()=>o("label",{for:"dba"},"DBA",-1)),qe={class:"field"},ze=u(()=>o("label",{for:"name"},"Contractor Name",-1)),He={class:"field"},Ge=u(()=>o("label",{for:"phone"},"Cell Phone",-1)),Ke={class:"field"},Ye=u(()=>o("label",{for:"email"},"Email",-1)),Ze={key:0,class:"error"},Je={class:"field"},Qe=u(()=>o("label",{for:"muni"},"Municipality",-1)),Xe={class:"field"},eo=u(()=>o("label",{for:"folio"},"Folio",-1)),oo={class:"field"},ao=u(()=>o("label",{for:"permit"},"Master Permit",-1)),lo={class:"field"},so=u(()=>o("label",{for:"processnum"},"mEProcess #",-1)),to={key:0,class:"response span-2"},no={class:"span-2 submit-row"},io={__name:"PermitApp",setup(r){const d=a(!1),v=a(""),S=a(!1),h=a(!1);re(),we();const{procData:C,procReceive:x}=ne(),{accountUsers:p}=ke(),w=Ne(),{callPermitdata:k}=Ie(),E=a([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),K=a("me");z(()=>{const{width:t,isUltraWide:e,height:c,isLongScreen:m}=Se();return console.log(t,e),{width:t,isUltraWide:e,height:c,isLongScreen:m}});const l=de({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",phNumber:"",emails:"",muniProc:"",historic:Boolean,date:new Date}),f=a(""),T=a(""),Y=a(!0),A=a(!1),b=a(""),N=a(""),y=a(""),B=a(""),M=a(""),V=a([]),g=a(""),D=a(!1);z(()=>{var t;D.value===!1&&((t=p.value[0])==null?void 0:t.secondary_status)==="I"?(console.log(D.value),alert("Your license is Inactive!")):D.value=!0}),ce(()=>{F(),S.value=!0,localStorage.clear()});const Z=H(()=>{var t,e;return((t=p.value[0])==null?void 0:t.bphone)!==""&&(A.value=!0,y.value=p.value[0].bphone,console.log(y.value)),A.value===!0?y.value:(e=p.value[0])==null?void 0:e.bphone});me(F,Z,()=>{});async function F(){var t,e,c,m,i;V.value=await p.value[0],B.value=((t=V.value)==null?void 0:t.name)||"",M.value=((e=V.value)==null?void 0:e.email)||"",b.value=((c=V.value)==null?void 0:c.secondary_status)||"",console.log(b.value),N.value=((m=V.value)==null?void 0:m.dba)||"",y.value=(i=p.value[0])==null?void 0:i.bphone}pe(async()=>{await be(A).toBe(!0)});const L=H(()=>Y.value?E.value[0]:""),{resNum:J}=ie(),O=a(""),R=a(""),j=a(null),_=a(""),W=a(null),$=a("");async function Q(t){d.value=!0,W.value=null;try{const e=await fetch(t);j.value=await e.json(),_.value=j.value.body.MinimumPropertyInfos[0],console.log(_.value),l.contractor=_.value.dba,l.license=_.value.secondary_status,l.muni=_.value.Municipality,l.folio=_.value.Strap,h.value=await j.value.body.isHistoric,R.value=l.folio,$.value=R.value.substring(1,2),O.value=G($)}catch(e){alert("No data found or enter correct address!"),W.value=e.message}finally{d.value=!1}}async function X(){try{d.value=!0,setTimeout(()=>d.value=!1,1e3),T.value=f.value;const e=`https://6x2kydgvuahfitwvxkkfbybv6u0kbxgl.lambda-url.us-east-1.on.aws/?address=${g.value}`;await Q(e),Object.assign(l,{license:b.value,contractor:N.value,emails:M.value,muniProc:f.value,phNumber:y.value});const c=String(J.value).substring(3,19),m=G(c).value+1;l.processNumber=K.value.concat(String(m)),l.muniProc=f.value,l.address=g.value,w.addSystem(l),await x(l),await k(l)}catch(t){alert(t)}}async function ee(){w.addSystem(l,L.value,O.value,f.value,T.value,g.value)}return(t,e)=>{const c=ue,m=te,i=se,q=le,oe=ae;return P(),U(he,null,[S.value?(P(),ve(c,{key:0})):I("",!0),o("section",xe,[o("div",Ae,[Be,n(m,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=s=>L.value=s),options:E.value,optionLabel:"name",placeholder:"Select a permit type",class:"w-full permit-select"},null,8,["modelValue","options"]),o("form",{class:"grid-form",onSubmit:fe(ee,["prevent"])},[o("div",De,[Le,n(i,{id:"license",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=s=>b.value=s),placeholder:"active / inactive"},null,8,["modelValue"])]),o("div",je,[Ce,n(i,{id:"processMuni",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=s=>f.value=s),placeholder:"00000000"},null,8,["modelValue"])]),o("div",Ee,[Te,o("div",Fe,[n(i,{id:"addr",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s),placeholder:"123 SW 1st St"},null,8,["modelValue"]),n(q,{type:"button",icon:"pi pi-search",loading:d.value,onClick:X},null,8,["loading"])])]),o("div",Oe,[h.value?(P(),U("span",Re,"Property is Historic")):I("",!0)]),o("div",We,[$e,n(i,{id:"dba",modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=s=>N.value=s),placeholder:"company alias"},null,8,["modelValue"])]),o("div",qe,[ze,n(i,{id:"name",modelValue:B.value,"onUpdate:modelValue":e[5]||(e[5]=s=>B.value=s),placeholder:"full name"},null,8,["modelValue"])]),o("div",He,[Ge,n(oe,{id:"phone",modelValue:l.phNumber,"onUpdate:modelValue":e[6]||(e[6]=s=>l.phNumber=s),mask:"(999) 999-9999",placeholder:"(999) 999-9999"},null,8,["modelValue"])]),o("div",Ke,[Ye,n(i,{id:"email",modelValue:M.value,"onUpdate:modelValue":e[7]||(e[7]=s=>M.value=s),invalid:t.invalid,placeholder:"you@example.com"},null,8,["modelValue","invalid"]),t.invalid?(P(),U("small",Ze,"Email is required")):I("",!0)]),o("div",Je,[Qe,n(i,{id:"muni",modelValue:l.muni,"onUpdate:modelValue":e[8]||(e[8]=s=>l.muni=s),placeholder:"Miami"},null,8,["modelValue"])]),o("div",Xe,[eo,n(i,{id:"folio",modelValue:l.folio,"onUpdate:modelValue":e[9]||(e[9]=s=>l.folio=s),placeholder:"00-0000-000-0000",onInput:t.updatemEProcess},null,8,["modelValue","onInput"])]),o("div",oo,[ao,n(i,{id:"permit",modelValue:l.permit,"onUpdate:modelValue":e[10]||(e[10]=s=>l.permit=s),placeholder:"20000000"},null,8,["modelValue"])]),o("div",lo,[so,n(i,{id:"processnum",modelValue:l.processNumber,"onUpdate:modelValue":e[11]||(e[11]=s=>l.processNumber=s),placeholder:"auto-generated"},null,8,["modelValue"])]),v.value?(P(),U("p",to,_e(v.value),1)):I("",!0),o("div",no,[n(q,{label:"Submit",type:"submit",loading:d.value,severity:"contrast",raised:"",as:"router-link",to:"/roofsystem"},null,8,["loading"])])],32)])])],64)}}},Uo=Me(io,[["__scopeId","data-v-458ffcc2"]]);export{Uo as default};
