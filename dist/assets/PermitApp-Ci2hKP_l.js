import{s as oe}from"./index-CsbYHtvJ.js";import{s as ae}from"./index-D7cdsMnX.js";import{s as le}from"./index-BPxoyx4x.js";import{s as se}from"./index-GFfkhKxs.js";import{u as te,a as ne,_ as ie}from"./use-createProcessnumber-is6Zwycf.js";import{e as t,f as x,h as re,g as T,Z as ue,J as W,ad as ce,ae as de,o as P,c as U,a as me,d as M,j as a,k as i,K as pe,t as ve,F as fe,af as he,Y as $,q as be,v as _e}from"./index-JMpC5vnI.js";import{u as ye,a as ge}from"./useAxios-Dv3B_cJm.js";import{u as Ve}from"./useScreenSize-kyWRYQZd.js";import{u as Pe}from"./accountsStore-xb8oO36w.js";import{u as Se}from"./permitapp-Bo8_7I9r.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-m3qcElWz.js";import"./index-DkTynFrv.js";import"./index-CJqhvQBi.js";import"./index-DwHXNODV.js";import"./index-B0QkfyXg.js";import"./index-C-WTDV5q.js";import"./index-DYC-S0mO.js";import"./index-isdF033D.js";import"./processStore-C6307FeY.js";const we="https://mg7y3qizyjvkkwd7ynpoc2r2yi0gerzh.lambda-url.us-east-1.on.aws/";function Ie(){const d=t(!1),p=t(null),f=t(null),{data:S,error:h,isFetching:y,execute:N}=ye(we,{method:"POST",headers:{"Content-Type":"application/json"}},ge,{immediate:!1});return{data:S,errors:p,isFetching:y,loading:d,callPermitdata:async b=>{f.value=b,console.log(f.value),d.value=!0,h.value=null;try{return await N({data:f.value})}catch(k){h.value=k.massage,console.error("Lambda post failed:",k)}finally{d.value=!1}}}}const u=d=>(be("data-v-aa1d483f"),d=d(),_e(),d),Ue={class:"hero"},Me={class:"card"},Ne=u(()=>a("h1",{class:"title"},"Permit Application",-1)),Ae={class:"field"},Be=u(()=>a("label",{for:"license"},"License Status",-1)),xe={class:"field"},De=u(()=>a("label",{for:"processMuni"},"Municipality Process #",-1)),je={class:"field"},Ce=u(()=>a("label",{for:"addr"},"Property Address",-1)),Le={class:"input-row"},Ee={class:"field"},Fe={key:0,class:"historic-indicator"},Oe={class:"field"},Re=u(()=>a("label",{for:"dba"},"DBA",-1)),Te={class:"field"},We=u(()=>a("label",{for:"name"},"Contractor Name",-1)),$e={class:"field"},qe=u(()=>a("label",{for:"phone"},"Cell Phone",-1)),ze={class:"field"},He=u(()=>a("label",{for:"email"},"Email",-1)),Ye={key:0,class:"error"},Ge={class:"field"},Je=u(()=>a("label",{for:"muni"},"Municipality",-1)),Ke={class:"field"},Ze=u(()=>a("label",{for:"folio"},"Folio",-1)),Qe={class:"field"},Xe=u(()=>a("label",{for:"permit"},"Master Permit",-1)),eo={class:"field"},oo=u(()=>a("label",{for:"processnum"},"mEProcess #",-1)),ao={key:0,class:"response span-2"},lo={class:"span-2 submit-row"},so={__name:"PermitApp",setup(d){const p=t(!1),f=t(""),S=t(!1),h=x({dba:"",jobaddress:"",municipality:"",muniprocessnumber:"",processnumber:"",masterpermit:"",license:""}),y=t(!1);re();const{procReceive:N}=te(),{accountUsers:v}=Pe(),b=Se(),{callPermitdata:k}=Ie(),D=t([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),q=t("me");T(()=>{const{width:l,isUltraWide:e,height:c,isLongScreen:m}=Ve();return console.log(l,e),{width:l,isUltraWide:e,height:c,isLongScreen:m}});const o=x({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",phNumber:"",emails:"",muniProc:"",historic:Boolean,date:new Date,checkIfBeach:0}),g=t(""),z=t(""),H=t(!0),A=t(!1),n=x({licenseStat:"",dba:"",phone:"",name:"",email:""}),_=t([]),w=t(""),j=t(!1);T(()=>{var l;j.value===!1&&((l=v.value[0])==null?void 0:l.secondary_status)==="I"?alert("Your license is Inactive!"):j.value=!0}),ue(()=>{B(),S.value=!0,localStorage.clear()});const Y=W(()=>{var l,e,c;return((l=v.value[0])==null?void 0:l.bphone)!==""&&(A.value=!0,phone.value=(e=v.value[0])==null?void 0:e.bphone,console.log(phone.value)),A.value===!0?phone.value:(c=v.value[0])==null?void 0:c.bphone});ce(B,Y,()=>{console.log(B)});async function B(){var l,e,c,m,r;console.log(v.value),_.value=v.value[0],n.name=((l=_.value)==null?void 0:l.name)||"",n.email=((e=_.value)==null?void 0:e.email)||"",n.licenseStat=((c=_.value)==null?void 0:c.secondary_status)||"",n.dba=((m=_.value)==null?void 0:m.dba)||"",n.phone=((r=_.value)==null?void 0:r.cphone)||"",console.log(n)}de(async()=>{await he(A).toBe(!0)});const C=W(()=>H.value?D.value[0]:""),{resNum:G}=ne(),L=t(""),I=t(null),V=t(""),E=t(null),F=t(""),O=t(null);async function J(l){p.value=!0,E.value=null;try{const e=await fetch(l);I.value=await e.json(),console.log("Line 171: ",I.value.body.MinimumPropertyInfos[0]),V.value=I.value.body.MinimumPropertyInfos[0],console.log(V.value),o.contractor=n.dba,o.license=V.value.secondary_status,o.muni=V.value.Municipality,o.folio=V.value.Strap,y.value=await I.value.body.isHistoric,console.log(y.value),L.value=o.folio}catch(e){alert("No data found or enter correct address!"),E.value=e.message}finally{p.value=!1}}async function K(l){const e=l.value;console.log(l.value,e),l.value===2&&(o.checkIfBeach=l.value,console.log("Updated mbId:",o.checkIfBeach))}async function Z(){try{p.value=!0,z.value=g.value;const l=w.value.toUpperCase();console.log(l);const e=`https://6x2kydgvuahfitwvxkkfbybv6u0kbxgl.lambda-url.us-east-1.on.aws/?address=${l}`;await J(e),Object.assign(o,{license:n.licenseStat,dba:n.dba,emails:n.email,muniprocessnumber:g.value,phonenumber:n.phone});const c=String(G.value).substring(3,19),m=$(c).value+1;o.processNumber=q.value.concat(String(m)),o.muniProc=g.value,o.address=w.value,Object.assign(h,{dba:o.contractor,jobaddress:o.address,municipality:o.muni,muniprocessnumber:o.muniProc,processnumber:o.processNumber,masterpermit:o.permit,license:o.license}),console.log("Line 242: ",h),F.value=L.value.substring(1,2),O.value=$(F),K(O.value),b.addSystem(o),await N(o),await k(h)}catch(l){alert(l)}}async function Q(){b.addSystem(o,mbId)}function X(){b.addSystem(o,mbId),console.log(b)}return(l,e)=>{const c=ie,m=se,r=le,R=ae,ee=oe;return P(),U(fe,null,[S.value?(P(),me(c,{key:0})):M("",!0),a("section",Ue,[a("div",Me,[Ne,i(m,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),options:D.value,optionLabel:"name",placeholder:"Select a permit type",class:"w-full permit-select"},null,8,["modelValue","options"]),a("form",{class:"grid-form",onSubmit:pe(Q,["prevent"])},[a("div",Ae,[Be,i(r,{id:"license",modelValue:n.licenseStat,"onUpdate:modelValue":e[1]||(e[1]=s=>n.licenseStat=s),placeholder:"active / inactive"},null,8,["modelValue"])]),a("div",xe,[De,i(r,{id:"processMuni",modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s),placeholder:"00000000"},null,8,["modelValue"])]),a("div",je,[Ce,a("div",Le,[i(r,{id:"addr",modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=s=>w.value=s),placeholder:"123 SW 1st St"},null,8,["modelValue"]),i(R,{type:"button",icon:"pi pi-search",loading:p.value,onClick:Z},null,8,["loading"])])]),a("div",Ee,[y.value?(P(),U("span",Fe,"Property is Historic")):M("",!0)]),a("div",Oe,[Re,i(r,{id:"dba",modelValue:n.dba,"onUpdate:modelValue":e[4]||(e[4]=s=>n.dba=s),placeholder:"company alias"},null,8,["modelValue"])]),a("div",Te,[We,i(r,{id:"name",modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=s=>n.name=s),placeholder:"full name"},null,8,["modelValue"])]),a("div",$e,[qe,i(ee,{id:"phone",modelValue:n.phone,"onUpdate:modelValue":e[6]||(e[6]=s=>n.phone=s),mask:"(999) 999-9999",placeholder:"(999) 999-9999"},null,8,["modelValue"])]),a("div",ze,[He,i(r,{id:"email",modelValue:n.email,"onUpdate:modelValue":e[7]||(e[7]=s=>n.email=s),invalid:l.invalid,placeholder:"you@example.com"},null,8,["modelValue","invalid"]),l.invalid?(P(),U("small",Ye,"Email is required")):M("",!0)]),a("div",Ge,[Je,i(r,{id:"muni",modelValue:o.muni,"onUpdate:modelValue":e[8]||(e[8]=s=>o.muni=s),placeholder:"Miami"},null,8,["modelValue"])]),a("div",Ke,[Ze,i(r,{id:"folio",modelValue:o.folio,"onUpdate:modelValue":e[9]||(e[9]=s=>o.folio=s),placeholder:"00-0000-000-0000",onInput:l.updatemEProcess},null,8,["modelValue","onInput"])]),a("div",Qe,[Xe,i(r,{id:"permit",modelValue:o.permit,"onUpdate:modelValue":e[10]||(e[10]=s=>o.permit=s),placeholder:"20000000"},null,8,["modelValue"])]),a("div",eo,[oo,i(r,{id:"processnum",modelValue:o.processNumber,"onUpdate:modelValue":e[11]||(e[11]=s=>o.processNumber=s),placeholder:"auto-generated"},null,8,["modelValue"])]),f.value?(P(),U("p",ao,ve(f.value),1)):M("",!0),a("div",lo,[i(R,{label:"Submit",type:"submit",loading:p.value,severity:"contrast",raised:"",as:"router-link",to:"/roofsystem",onUpdate:X},null,8,["loading"])])],32)])])],64)}}},Io=ke(so,[["__scopeId","data-v-aa1d483f"]]);export{Io as default};
