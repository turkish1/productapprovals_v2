import{s as ae}from"./index-DFB6-B4N.js";import{s as le}from"./index-C76FVFHQ.js";import{s as se}from"./index-yciBK818.js";import{s as te}from"./index-BTzkct3s.js";import{u as ne,a as ie,_ as ue}from"./use-createProcessnumber-BAti84Eh.js";import{e as a,u as re,h as z,f as de,Y as ce,I as H,ac as me,ad as pe,o as P,c as M,a as ve,d as U,i as o,j as n,J as fe,t as _e,F as he,af as be,X as Y,p as ye,q as Ve}from"./index-B4ipf8sK.js";import{u as ge,a as Pe}from"./useAxios-CoY-q13_.js";import{u as Se}from"./useScreenSize-RIYYqmnh.js";import{u as we}from"./processStore-DAKdBurV.js";import{u as ke}from"./accountsStore-BejTad4X.js";import{u as Ne}from"./permitapp-CWrPVcrc.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DyfismO2.js";import"./index-DCMTlQwM.js";import"./index-BoUBLWZg.js";import"./index-Bk4oefTi.js";import"./index-kwRfur5i.js";import"./index-Bky1wum0.js";import"./index-DrXErCKt.js";const Ue="https://mg7y3qizyjvkkwd7ynpoc2r2yi0gerzh.lambda-url.us-east-1.on.aws/";function Ie(){const r=a(!1),d=a(null),v=a(null),{data:S,error:h,isFetching:E,execute:I}=ge(Ue,{method:"POST",headers:{"Content-Type":"application/json"}},Pe,{immediate:!1});return{data:S,errors:d,isFetching:E,loading:r,callPermitdata:async x=>{v.value=x,console.log(v.value),r.value=!0,h.value=null;try{return await I({data:v.value})}catch(w){h.value=w.massage,console.error("Lambda post failed:",w)}finally{r.value=!1}}}}const u=r=>(ye("data-v-40f218dd"),r=r(),Ve(),r),xe={class:"hero"},Ae={class:"card"},Be=u(()=>o("h1",{class:"title"},"Permit Application",-1)),De={class:"field"},je=u(()=>o("label",{for:"license"},"License Status",-1)),Ce={class:"field"},Ee=u(()=>o("label",{for:"processMuni"},"Municipality Process #",-1)),Le={class:"field"},Te=u(()=>o("label",{for:"addr"},"Property Address",-1)),Fe={class:"input-row"},Oe={class:"field"},Re={key:0,class:"historic-indicator"},We={class:"field"},$e=u(()=>o("label",{for:"dba"},"DBA",-1)),qe={class:"field"},ze=u(()=>o("label",{for:"name"},"Contractor Name",-1)),He={class:"field"},Ye=u(()=>o("label",{for:"phone"},"Cell Phone",-1)),Ge={class:"field"},Je=u(()=>o("label",{for:"email"},"Email",-1)),Xe={key:0,class:"error"},Ke={class:"field"},Qe=u(()=>o("label",{for:"muni"},"Municipality",-1)),Ze={class:"field"},eo=u(()=>o("label",{for:"folio"},"Folio",-1)),oo={class:"field"},ao=u(()=>o("label",{for:"permit"},"Master Permit",-1)),lo={class:"field"},so=u(()=>o("label",{for:"processnum"},"mEProcess #",-1)),to={key:0,class:"response span-2"},no={class:"span-2 submit-row"},io={__name:"PermitApp",setup(r){const d=a(!1),v=a(""),S=a(!1),h=a(!1);re(),we();const{procData:E,procReceive:I}=ne(),{accountUsers:p}=ke(),x=Ne(),{callPermitdata:w}=Ie(),L=a([{name:"Roofing Permit",code:"RP"},{name:"Doors Permit",code:"DP"},{name:"Windows Permit",code:"WP"}]),G=a("me");z(()=>{const{width:t,isUltraWide:e,height:c,isLongScreen:m}=Se();return console.log(t,e),{width:t,isUltraWide:e,height:c,isLongScreen:m}});const s=de({address:"",muni:"",license:"",folio:"",contractor:"",permit:"",processNumber:"",phNumber:"",emails:"",muniProc:"",historic:Boolean,date:new Date}),f=a(""),T=a(""),J=a(!0),A=a(!1),b=a(""),k=a(""),y=a(""),B=a(""),N=a(""),V=a([]),g=a(""),D=a(!1);z(()=>{var t;D.value===!1&&((t=p.value[0])==null?void 0:t.secondary_status)==="I"?(console.log(D.value),alert("Your license is Inactive!")):D.value=!0}),ce(()=>{F(),S.value=!0,localStorage.clear()});const X=H(()=>{var t,e;return((t=p.value[0])==null?void 0:t.bphone)!==""&&(A.value=!0,y.value=p.value[0].bphone,console.log(y.value)),A.value===!0?y.value:(e=p.value[0])==null?void 0:e.bphone});me(F,X,()=>{});async function F(){var t,e,c,m,i;V.value=await p.value[0],B.value=((t=V.value)==null?void 0:t.name)||"",N.value=((e=V.value)==null?void 0:e.email)||"",b.value=((c=V.value)==null?void 0:c.secondary_status)||"",console.log(b.value),k.value=((m=V.value)==null?void 0:m.dba)||"",y.value=(i=p.value[0])==null?void 0:i.bphone}pe(async()=>{await be(A).toBe(!0)});const j=H(()=>J.value?L.value[0]:""),{resNum:K}=ie(),O=a(""),R=a(""),C=a(null),_=a(""),W=a(null),$=a("");async function Q(t){d.value=!0,W.value=null;try{const e=await fetch(t);C.value=await e.json(),_.value=C.value.body.MinimumPropertyInfos[0],console.log(_.value),s.contractor=_.value.dba,s.license=_.value.secondary_status,s.muni=_.value.Municipality,s.folio=_.value.Strap,h.value=await C.value.body.isHistoric,R.value=s.folio,$.value=R.value.substring(1,2),O.value=Y($)}catch(e){alert("No data found or enter correct address!"),W.value=e.message}finally{d.value=!1}}async function Z(){try{d.value=!0,setTimeout(()=>d.value=!1,1e3),T.value=f.value;const e=`https://6x2kydgvuahfitwvxkkfbybv6u0kbxgl.lambda-url.us-east-1.on.aws/?address=${g.value}`;await Q(e),Object.assign(s,{license:b.value,contractor:k.value,emails:N.value,muniProc:f.value,phNumber:y.value});const c=String(K.value).substring(3,19),m=Y(c).value+1;s.processNumber=G.value.concat(String(m)),s.muniProc=f.value,s.address=g.value,await I(s),await w(s)}catch(t){alert(t)}}async function ee(){x.addSystem(s,j.value,O.value,f.value,T.value,g.value)}return(t,e)=>{const c=ue,m=te,i=se,q=le,oe=ae;return P(),M(he,null,[S.value?(P(),ve(c,{key:0})):U("",!0),o("section",xe,[o("div",Ae,[Be,n(m,{modelValue:j.value,"onUpdate:modelValue":e[0]||(e[0]=l=>j.value=l),options:L.value,optionLabel:"name",placeholder:"Select a permit type",class:"w-full permit-select"},null,8,["modelValue","options"]),o("form",{class:"grid-form",onSubmit:fe(ee,["prevent"])},[o("div",De,[je,n(i,{id:"license",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),placeholder:"active / inactive"},null,8,["modelValue"])]),o("div",Ce,[Ee,n(i,{id:"processMuni",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),placeholder:"00000000"},null,8,["modelValue"])]),o("div",Le,[Te,o("div",Fe,[n(i,{id:"addr",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),placeholder:"123 SW 1st St"},null,8,["modelValue"]),n(q,{type:"button",icon:"pi pi-search",loading:d.value,onClick:Z},null,8,["loading"])])]),o("div",Oe,[h.value?(P(),M("span",Re,"Property is Historic")):U("",!0)]),o("div",We,[$e,n(i,{id:"dba",modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=l=>k.value=l),placeholder:"company alias"},null,8,["modelValue"])]),o("div",qe,[ze,n(i,{id:"name",modelValue:B.value,"onUpdate:modelValue":e[5]||(e[5]=l=>B.value=l),placeholder:"full name"},null,8,["modelValue"])]),o("div",He,[Ye,n(oe,{id:"phone",modelValue:s.phNumber,"onUpdate:modelValue":e[6]||(e[6]=l=>s.phNumber=l),mask:"(999) 999-9999",placeholder:"(999) 999-9999"},null,8,["modelValue"])]),o("div",Ge,[Je,n(i,{id:"email",modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=l=>N.value=l),invalid:t.invalid,placeholder:"you@example.com"},null,8,["modelValue","invalid"]),t.invalid?(P(),M("small",Xe,"Email is required")):U("",!0)]),o("div",Ke,[Qe,n(i,{id:"muni",modelValue:s.muni,"onUpdate:modelValue":e[8]||(e[8]=l=>s.muni=l),placeholder:"Miami"},null,8,["modelValue"])]),o("div",Ze,[eo,n(i,{id:"folio",modelValue:s.folio,"onUpdate:modelValue":e[9]||(e[9]=l=>s.folio=l),placeholder:"00-0000-000-0000",onInput:t.updatemEProcess},null,8,["modelValue","onInput"])]),o("div",oo,[ao,n(i,{id:"permit",modelValue:s.permit,"onUpdate:modelValue":e[10]||(e[10]=l=>s.permit=l),placeholder:"20000000"},null,8,["modelValue"])]),o("div",lo,[so,n(i,{id:"processnum",modelValue:s.processNumber,"onUpdate:modelValue":e[11]||(e[11]=l=>s.processNumber=l),placeholder:"auto-generated"},null,8,["modelValue"])]),v.value?(P(),M("p",to,_e(v.value),1)):U("",!0),o("div",no,[n(q,{label:"Submit",type:"submit",loading:d.value,severity:"contrast",raised:"",as:"router-link",to:"/roofsystem"},null,8,["loading"])])],32)])])],64)}}},Uo=Me(io,[["__scopeId","data-v-40f218dd"]]);export{Uo as default};
